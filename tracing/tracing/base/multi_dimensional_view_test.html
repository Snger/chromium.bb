<!DOCTYPE html>
<!--
Copyright 2016 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<link rel="import" href="/tracing/base/iteration_helpers.html">
<link rel="import" href="/tracing/base/multi_dimensional_view.html">

<script>
'use strict';

tr.b.unittest.testSuite(function() {
  var MultiDimensionalViewBuilder = tr.b.MultiDimensionalViewBuilder;
  var SELF = MultiDimensionalViewBuilder.ValueKind.SELF;
  var TOTAL = MultiDimensionalViewBuilder.ValueKind.TOTAL;
  var RecursionDepthTracker = tr.b.RecursionDepthTracker;
  var zFunction = tr.b.zFunction;

  function checkTree(actualTreeRootNode, expectedStructureRootNode) {
    // Build map from expected structure node IDs to expected structure nodes.
    var expectedStructureNodesById = new Map();
    addExpectedStructureToMap(
        expectedStructureRootNode, expectedStructureNodesById);

    // Recursively check the structure of the actual tree.
    var actualTreeNodesById = new Map();
    checkTreeStructure(actualTreeRootNode, expectedStructureRootNode,
        actualTreeNodesById, expectedStructureNodesById);

    // Test sanity check.
    assert.strictEqual(
        actualTreeNodesById.size, expectedStructureNodesById.size);
  }

  function addExpectedStructureToMap(expectedStructureNode, map) {
    if (typeof expectedStructureNode === 'string')
      return;  // Reference to another expected structure node.

    var expectedStructureNodeId = expectedStructureNode.id;
    if (expectedStructureNodeId !== undefined) {
      assert.isFalse(map.has(expectedStructureNodeId));
      map.set(expectedStructureNodeId, expectedStructureNode);
    }

    var expectedStructureChildren = expectedStructureNode.children;
    for (var d = 0; d < expectedStructureChildren.length; d++) {
      var expectedStructureDimensionChildren = expectedStructureChildren[d];
      for (var i = 0; i < expectedStructureDimensionChildren.length; i++)
        addExpectedStructureToMap(expectedStructureDimensionChildren[i], map);
    }
  }

  function checkTreeStructure(actualTreeNode, expectedStructureNode,
      actualTreeNodesById, expectedStructureNodesById) {
    // Check the multi-dimensional title.
    assert.deepEqual(
        tr.b.asArray(actualTreeNode.title), expectedStructureNode.title);

    // Check the values.
    assert.strictEqual(actualTreeNode.total, expectedStructureNode.total);
    assert.strictEqual(actualTreeNode.self, expectedStructureNode.self);
    assert.strictEqual(
        actualTreeNode.isLowerBound, expectedStructureNode.isLowerBound);

    // Check the children.
    var expectedStructureChildNodes = expectedStructureNode.children;
    var actualTreeChildNodes = actualTreeNode.children;
    assert.lengthOf(actualTreeChildNodes, expectedStructureChildNodes.length);

    for (var d = 0; d < expectedStructureChildNodes.length; d++) {
      var expectedStructureDimensionChildNodes = expectedStructureChildNodes[d];
      var actualTreeDimensionChildNodes = actualTreeChildNodes[d];
      assert.strictEqual(actualTreeDimensionChildNodes.size,
          expectedStructureDimensionChildNodes.length);

      var expectedStructureDimensionChildNodeTitles = new Set();

      for (var i = 0; i < expectedStructureDimensionChildNodes.length; i++) {
        var expectedStructureDimensionChildNode =
            expectedStructureDimensionChildNodes[i];
        var isReference = false;

        // If the expected structure child node is a reference to another
        // expected structure node, resolve it.
        if (typeof expectedStructureDimensionChildNode === 'string') {
          expectedStructureDimensionChildNode = expectedStructureNodesById.get(
              expectedStructureDimensionChildNode);
          assert.isDefined(expectedStructureDimensionChildNode);
          isReference = true;
        }

        // Check that the expected structure doesn't contain two children with
        // the same title.
        var childTitle = expectedStructureDimensionChildNode.title[d];
        assert.isFalse(
            expectedStructureDimensionChildNodeTitles.has(childTitle));
        expectedStructureDimensionChildNodeTitles.add(childTitle);

        // Get the associated child node of the actual tree.
        var actualTreeDimensionChildNode =
            actualTreeDimensionChildNodes.get(childTitle);
        assert.isDefined(actualTreeDimensionChildNode);

        // Check that all expected structure nodes with the same ID correspond
        // to the same actual tree node.
        var childId = expectedStructureDimensionChildNode.id;
        if (childId !== undefined) {
          if (actualTreeNodesById.has(childId)) {
            assert.strictEqual(actualTreeDimensionChildNode,
                actualTreeNodesById.get(childId));
          } else {
            actualTreeNodesById.set(childId, actualTreeDimensionChildNode);
          }
        }

        // Recursively check the structure of the actual tree child node
        // (unless the expected structure child node was a reference).
        if (!isReference) {
          checkTreeStructure(actualTreeDimensionChildNode,
              expectedStructureDimensionChildNode, actualTreeNodesById,
              expectedStructureNodesById);
        }
      }

      // Test sanity check (all child titles should be unique).
      assert.strictEqual(expectedStructureDimensionChildNodeTitles.size,
          expectedStructureDimensionChildNodes.length);
    }
  }

  function createBuilderWithEntries(dimensions, pathEntries) {
    var builder = new MultiDimensionalViewBuilder(dimensions);
    pathEntries.forEach(function(pathEntry) {
      builder.addPath(pathEntry.path, pathEntry.value, pathEntry.kind);
    });
    return builder;
  }

  function builderTest(testName, dimensions, pathEntries,
      expectedTreeViewStructure, expectedHeavyViewStructure) {
    test('builder_' + testName, function() {
      // Create a multi-dimensional tree builder and add all paths to it.
      var builder = createBuilderWithEntries(dimensions, pathEntries);

      // Build and check the tree view.
      var treeViewRoot = builder.buildTreeView();
      checkTree(treeViewRoot, expectedTreeViewStructure);

      // Build and check the heavy view.
      var heavyViewRoot = builder.buildHeavyView();
      checkTree(heavyViewRoot, expectedHeavyViewStructure);
    });
  }

  /**
   * Calculate the sum of binary powers.
   *
   * Each exponent can either be (1) a single number corresponding to a single
   * power of two (2**exponent), or (2) a two-element list for a sum over a
   * range of exponents (2**exponent[0] + 2**(exponent[0] + 1) + ... +
   * 2**exponent[1]).
   */
  function b(/* exponent1, ..., exponentN */) {

    var sum = 0;
    for (var i = 0; i < arguments.length; i++) {
      var exponent = arguments[i];
      if (typeof exponent === 'number') {
        sum += 1 << arguments[i];
      } else {
        assert.lengthOf(exponent, 2);  // Test sanity check.
        // We use the fact that 2**A + 2**(A + 1) ... + 2**B =
        // (2**0 + 2**1 + ... 2**B) - (2**0 + 2**1 + ... + 2**(A - 1)) =
        // (2**(B + 1) - 1) - (2**A - 1) = 2**(B + 1) - 2**A.
        sum += (1 << (exponent[1] + 1)) - (1 << exponent[0]);
      }
    }
    return sum;
  }

  function checkZFunction(list, expectedResult) {
    if (typeof list === 'string') {
      assert.deepEqual(zFunction(list, 0), expectedResult);
      assert.deepEqual(zFunction(list[0] + list, 1), expectedResult);
      assert.deepEqual(zFunction(list + list, list.length), expectedResult);
    } else {
      assert.deepEqual(zFunction([].concat(list), 0), expectedResult);
      assert.deepEqual(zFunction([list[0]].concat(list), 1), expectedResult);
      assert.deepEqual(
          zFunction(list.concat(list), list.length), expectedResult);
    }
  }

  builderTest('zeroDimensions_noPaths', 0 /* dimensions */,
      [],
      {  // Tree view.
        title: [],
        total: 0,
        self: 0,
        isLowerBound: true,
        children: []
      },
      {  // Heavy view.
        title: [],
        total: 0,
        self: 0,
        isLowerBound: true,
        children: []
      });

  builderTest('zeroDimensions_withPaths', 0 /* dimensions */,
      [
        { path: [], value: 2, kind: SELF },
        { path: [], value: 3, kind: TOTAL },
        { path: [], value: 4, kind: SELF },
        { path: [], value: 5, kind: TOTAL }
      ],
      {  // Tree view.
        title: [],
        total: 8,
        self: 6,
        isLowerBound: false,
        children: []
      },
      {  // Heavy view.
        title: [],
        total: 8,
        self: 6,
        isLowerBound: false,
        children: []
      });

  builderTest('oneDimension_noPaths', 1 /* dimensions */,
      [],
      {  // Tree view.
        title: [undefined],
        total: 0,
        self: 0,
        isLowerBound: true,
        children: [
          []
        ]
      },
      {  // Heavy view.
        title: [undefined],
        total: 0,
        self: 0,
        isLowerBound: true,
        children: [
          []
        ]
      });

  builderTest('oneDimension_zeroLengthPath', 1 /* dimensions */,
      [
        { path: [[]], value: 42, kind: SELF }
      ],
      {  // Tree view.
        title: [undefined],
        total: 42,
        self: 42,
        isLowerBound: false,
        children: [
          []
        ]
      },
      {  // Heavy view.
        title: [undefined],
        total: 42,
        self: 42,
        isLowerBound: false,
        children: [
          []
        ]
      });

  builderTest('oneDimension_noRecursion', 1 /* dimensions */,
      [
        { path: [['A', 'B', 'C']], value: 10, kind: SELF },
        { path: [['A', 'B']], value: 20, kind: SELF },
        { path: [['B', 'D']], value: 30, kind: SELF },
        { path: [['A', 'B', 'D']], value: 40, kind: SELF },
        { path: [['A', 'C']], value: 50, kind: SELF },
        { path: [[]], value: 60, kind: SELF }
      ],
      {  // Tree view.
        title: [undefined],
        total: 210,
        self: 60,
        isLowerBound: false,
        children: [
          [
            {  // A.
              title: ['A'],
              total: 120,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  {  // A -> B.
                    title: ['B'],
                    total: 70,
                    self: 20,
                    isLowerBound: false,
                    children: [
                      [
                        {  // A -> B -> C.
                          title: ['C'],
                          total: 10,
                          self: 10,
                          isLowerBound: false,
                          children: [
                            []
                          ]
                        },
                        {  // A -> B -> D.
                          title: ['D'],
                          total: 40,
                          self: 40,
                          isLowerBound: false,
                          children: [
                            []
                          ]
                        }
                      ]
                    ]
                  },
                  {  // A -> C.
                    title: ['C'],
                    total: 50,
                    self: 50,
                    isLowerBound: false,
                    children: [
                      []
                    ]
                  }
                ]
              ]
            },
            {  // B.
              title: ['B'],
              total: 30,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  {  // B -> D.
                    title: ['D'],
                    total: 30,
                    self: 30,
                    isLowerBound: false,
                    children: [
                      []
                    ]
                  }
                ]
              ]
            }
          ]
        ]
      },
      {  // Heavy view.
        title: [undefined],
        total: 210,
        self: 60,
        isLowerBound: false,
        children: [
          [
            {  // A.
              title: ['A'],
              total: 120,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  {  // A -> B.
                    title: ['B'],
                    total: 70,
                    self: 20,
                    isLowerBound: true,
                    children: [
                      [
                        {  // A -> B -> C.
                          title: ['C'],
                          total: 10,
                          self: 10,
                          isLowerBound: true,
                          children: [
                            []
                          ]
                        },
                        {  // A -> B -> D.
                          title: ['D'],
                          total: 40,
                          self: 40,
                          isLowerBound: true,
                          children: [
                            []
                          ]
                        }
                      ]
                    ]
                  },
                  {  // A -> C.
                    title: ['C'],
                    total: 50,
                    self: 50,
                    isLowerBound: true,
                    children: [
                      []
                    ]
                  }
                ]
              ]
            },
            {  // B.
              title: ['B'],
              total: 100,
              self: 20,
              isLowerBound: true,
              children: [
                [
                  {  // B -> C.
                    title: ['C'],
                    total: 10,
                    self: 10,
                    isLowerBound: true,
                    children: [
                      []
                    ]
                  },
                  {  // B -> D.
                    title: ['D'],
                    total: 70,
                    self: 70,
                    isLowerBound: true,
                    children: [
                      []
                    ]
                  }
                ]
              ]
            },
            {  // C.
              title: ['C'],
              total: 60,
              self: 60,
              isLowerBound: true,
              children: [
                []
              ]
            },
            {  // D.
              title: ['D'],
              total: 70,
              self: 70,
              isLowerBound: true,
              children: [
                []
              ]
            }
          ]
        ]
      });

  builderTest('oneDimension_simpleRecursion', 1 /* dimensions */,
      [
        { path: [['A']], value: 10, kind: SELF },
        { path: [['A', 'A', 'A']], value: 20, kind: SELF },
        { path: [['A', 'A']], value: 30, kind: SELF },
        { path: [['A', 'A', 'A', 'A']], value: 40, kind: SELF }
      ],
      {  // Tree view.
        title: [undefined],
        total: 100,
        self: 0,
        isLowerBound: true,
        children: [
          [
            {  // A.
              title: ['A'],
              total: 100,
              self: 10,
              isLowerBound: false,
              children: [
                [
                  {  // A -> A.
                    title: ['A'],
                    total: 90,
                    self: 30,
                    isLowerBound: false,
                    children: [
                      [
                        {  // A -> A -> A.
                          title: ['A'],
                          total: 60,
                          self: 20,
                          isLowerBound: false,
                          children: [
                            [
                              {  // A -> A -> A -> A.
                                title: ['A'],
                                total: 40,
                                self: 40,
                                isLowerBound: false,
                                children: [
                                  []
                                ]
                              }
                            ]
                          ]
                        }
                      ]
                    ]
                  }
                ]
              ]
            }
          ]
        ]
      },
      {  // Heavy view.
        title: [undefined],
        total: 100,
        self: 0,
        isLowerBound: true,
        children: [
          [
            {  // A.
              title: ['A'],
              total: 100,
              self: 100,
              isLowerBound: true,
              children: [
                [
                  {  // A -> A.
                    title: ['A'],
                    total: 90,
                    self: 90,
                    isLowerBound: true,
                    children: [
                      [
                        {  // A -> A -> A.
                          title: ['A'],
                          total: 60,
                          self: 60,
                          isLowerBound: true,
                          children: [
                            [
                              {  // A -> A -> A -> A.
                                title: ['A'],
                                total: 40,
                                self: 40,
                                isLowerBound: true,
                                children: [
                                  []
                                ]
                              }
                            ]
                          ]
                        }
                      ]
                    ]
                  }
                ]
              ]
            }
          ]
        ]
      });

  builderTest('oneDimension_complexRecursion', 1 /* dimensions */,
      [
        { path: [['A', 'B', 'C']], value: 10, kind: SELF },
        { path: [['A', 'D', 'B', 'C', 'A', 'B', 'C']], value: 20, kind: SELF },
        { path: [['A', 'D', 'B', 'C', 'A', 'B', 'D']], value: 30, kind: SELF },
        { path: [['C', 'B', 'C']], value: 40, kind: SELF },
        { path: [['C', 'B', 'C', 'B', 'C']], value: 50, kind: SELF }
      ],
      {  // Tree view.
        title: [undefined],
        total: 150,
        self: 0,
        isLowerBound: true,
        children: [
          [
            {  // A.
              title: ['A'],
              total: 60,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  {  // A -> B.
                    title: ['B'],
                    total: 10,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        {  // A -> B -> C.
                          title: ['C'],
                          total: 10,
                          self: 10,
                          isLowerBound: false,
                          children: [
                            []
                          ]
                        }
                      ]
                    ]
                  },
                  {  // A -> D.
                    title: ['D'],
                    total: 50,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        {  // A -> D -> B.
                          title: ['B'],
                          total: 50,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [
                              {  // A -> D -> B -> C.
                                title: ['C'],
                                total: 50,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [
                                    {  // A -> D -> B -> C -> A.
                                      title: ['A'],
                                      total: 50,
                                      self: 0,
                                      isLowerBound: true,
                                      children: [
                                        [
                                          {  // A -> D -> B -> C -> A -> B.
                                            title: ['B'],
                                            total: 50,
                                            self: 0,
                                            isLowerBound: true,
                                            children: [
                                              [
                                                {  // A -> D -> B -> C -> A ->
                                                   // B -> C.
                                                  title: ['C'],
                                                  total: 20,
                                                  self: 20,
                                                  isLowerBound: false,
                                                  children: [
                                                    []
                                                  ]
                                                },
                                                {  // A -> D -> B -> C -> A ->
                                                   // B -> D.
                                                  title: ['D'],
                                                  total: 30,
                                                  self: 30,
                                                  isLowerBound: false,
                                                  children: [
                                                    []
                                                  ]
                                                }
                                              ]
                                            ]
                                          }
                                        ]
                                      ]
                                    }
                                  ]
                                ]
                              }
                            ]
                          ]
                        }
                      ]
                    ]
                  }
                ]
              ]
            },
            {  // C.
              title: ['C'],
              total: 90,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  {  // C -> B.
                    title: ['B'],
                    total: 90,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        {  // C -> B -> C.
                          title: ['C'],
                          total: 90,
                          self: 40,
                          isLowerBound: false,
                          children: [
                            [
                              {  // C -> B -> C -> B.
                                title: ['B'],
                                total: 50,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [
                                    {  // C -> B -> C -> B -> C.
                                      title: ['C'],
                                      total: 50,
                                      self: 50,
                                      isLowerBound: false,
                                      children: [
                                        []
                                      ]
                                    }
                                  ]
                                ]
                              }
                            ]
                          ]
                        }
                      ]
                    ]
                  }
                ]
              ]
            }
          ]
        ]
      },
      {  // Heavy view.
        title: [undefined],
        total: 150,
        self: 0,
        isLowerBound: true,
        children: [
          [
            {  // A.
              title: ['A'],
              total: 60,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  {  // A -> B.
                    title: ['B'],
                    total: 60,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        {  // A -> B -> C.
                          title: ['C'],
                          total: 30,
                          self: 30,
                          isLowerBound: true,
                          children: [
                            []
                          ]
                        },
                        {  // A -> B -> D.
                          title: ['D'],
                          total: 30,
                          self: 30,
                          isLowerBound: true,
                          children: [
                            []
                          ]
                        }
                      ]
                    ]
                  },
                  {  // A -> D.
                    title: ['D'],
                    total: 50,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        {  // A -> D -> B.
                          title: ['B'],
                          total: 50,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [
                              {  // A -> D -> B -> C.
                                title: ['C'],
                                total: 50,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [
                                    {  // A -> D -> B -> C -> A.
                                      title: ['A'],
                                      total: 50,
                                      self: 0,
                                      isLowerBound: true,
                                      children: [
                                        [
                                          {  // A -> D -> B -> C -> A -> B.
                                            title: ['B'],
                                            total: 50,
                                            self: 0,
                                            isLowerBound: true,
                                            children: [
                                              [
                                                {  // A -> D -> B -> C -> A ->
                                                   // B -> C.
                                                  title: ['C'],
                                                  total: 20,
                                                  self: 20,
                                                  isLowerBound: true,
                                                  children: [
                                                    []
                                                  ]
                                                },
                                                {  // A -> D -> B -> C -> A ->
                                                   // B -> D.
                                                  title: ['D'],
                                                  total: 30,
                                                  self: 30,
                                                  isLowerBound: true,
                                                  children: [
                                                    []
                                                  ]
                                                }
                                              ]
                                            ]
                                          }
                                        ]
                                      ]
                                    }
                                  ]
                                ]
                              }
                            ]
                          ]
                        }
                      ]
                    ]
                  }
                ]
              ]
            },
            {  // B.
              title: ['B'],
              total: 150,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  {  // B -> C.
                    title: ['C'],
                    total: 150,
                    self: 120,
                    isLowerBound: true,
                    children: [
                      [
                        {  // B -> C -> A.
                          title: ['A'],
                          total: 50,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [
                              {  // B -> C -> A -> B.
                                title: ['B'],
                                total: 50,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [
                                    {  // B -> C -> A -> B -> C.
                                      title: ['C'],
                                      total: 20,
                                      self: 20,
                                      isLowerBound: true,
                                      children: [
                                        []
                                      ]
                                    },
                                    {  // B -> C -> A -> B -> D.
                                      title: ['D'],
                                      total: 30,
                                      self: 30,
                                      isLowerBound: true,
                                      children: [
                                        []
                                      ]
                                    }
                                  ]
                                ]
                              }
                            ]
                          ]
                        },
                        {  // B -> C -> B.
                          title: ['B'],
                          total: 50,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [
                              {  // B -> C -> B -> C.
                                title: ['C'],
                                total: 50,
                                self: 50,
                                isLowerBound: true,
                                children: [
                                  []
                                ]
                              }
                            ]
                          ]
                        }
                      ]
                    ]
                  },
                  {  // B -> D.
                    title: ['D'],
                    total: 30,
                    self: 30,
                    isLowerBound: true,
                    children: [
                      []
                    ]
                  }
                ]
              ]
            },
            {  // C.
              title: ['C'],
              total: 150,
              self: 120,
              isLowerBound: true,
              children: [
                [
                  {  // C -> A.
                    title: ['A'],
                    total: 50,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        {  // C -> A -> B.
                          title: ['B'],
                          total: 50,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [
                              {  // C -> A -> B -> C.
                                title: ['C'],
                                total: 20,
                                self: 20,
                                isLowerBound: true,
                                children: [
                                  []
                                ]
                              },
                              {  // C -> A -> B -> D.
                                title: ['D'],
                                total: 30,
                                self: 30,
                                isLowerBound: true,
                                children: [
                                  []
                                ]
                              }
                            ]
                          ]
                        }
                      ]
                    ]
                  },
                  {  // C -> B.
                    title: ['B'],
                    total: 90,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        {  // C -> B -> C.
                          title: ['C'],
                          total: 90,
                          self: 90,
                          isLowerBound: true,
                          children: [
                            [
                              {  // C -> B -> C -> B.
                                title: ['B'],
                                total: 50,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [
                                    {  // C -> B -> C -> B -> C.
                                      title: ['C'],
                                      total: 50,
                                      self: 50,
                                      isLowerBound: true,
                                      children: [
                                        []
                                      ]
                                    }
                                  ]
                                ]
                              }
                            ]
                          ]
                        }
                      ]
                    ]
                  }
                ]
              ]
            },
            {  // D.
              title: ['D'],
              total: 50,
              self: 30,
              isLowerBound: true,
              children: [
                [
                  {  // D -> B.
                    title: ['B'],
                    total: 50,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        {  // D -> B -> C.
                          title: ['C'],
                          total: 50,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [
                              {  // D -> B -> C -> A.
                                title: ['A'],
                                total: 50,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [
                                    {  // D -> B -> C -> A -> B.
                                      title: ['B'],
                                      total: 50,
                                      self: 0,
                                      isLowerBound: true,
                                      children: [
                                        [
                                          {  // D -> B -> C -> A -> B -> C.
                                            title: ['C'],
                                            total: 20,
                                            self: 20,
                                            isLowerBound: true,
                                            children: [
                                              []
                                            ]
                                          },
                                          {  // D -> B -> C -> A -> B -> D.
                                            title: ['D'],
                                            total: 30,
                                            self: 30,
                                            isLowerBound: true,
                                            children: [
                                              []
                                            ]
                                          }
                                        ]
                                      ]
                                    }
                                  ]
                                ]
                              }
                            ]
                          ]
                        }
                      ]
                    ]
                  }
                ]
              ]
            }
          ]
        ]
      });

  builderTest('oneDimension_withTotalSizes', 1 /* dimensions */,
      [
        { path: [['B', 'C']], value: 10, kind: TOTAL },
        { path: [['B', 'C', 'D']], value: 5, kind: TOTAL },
        { path: [['B']], value: 15, kind: SELF },
        { path: [['B']], value: 20, kind: TOTAL },
        { path: [['B', 'D']], value: 40, kind: SELF },
        { path: [['C']], value: 50, kind: TOTAL }
      ],
      {  // Tree view.
        title: [undefined],
        total: 115,
        self: 0,
        isLowerBound: true,
        children: [
          [
            {  // B.
              title: ['B'],
              total: 65,
              self: 15,
              isLowerBound: false,
              children: [
                [
                  {  // B -> C.
                    title: ['C'],
                    total: 10,
                    self: 0,
                    isLowerBound: false,
                    children: [
                      [
                        {  // B -> C -> D.
                          title: ['D'],
                          total: 5,
                          self: 0,
                          isLowerBound: false,
                          children: [
                            []
                          ]
                        }
                      ]
                    ]
                  },
                  {  // B -> D.
                    title: ['D'],
                    total: 40,
                    self: 40,
                    isLowerBound: false,
                    children: [
                      []
                    ]
                  }
                ]
              ]
            },
            {  // C.
              title: ['C'],
              total: 50,
              self: 0,
              isLowerBound: false,
              children: [
                []
              ]
            }
          ]
        ]
      },
      {  // Heavy view.
        title: [undefined],
        total: 115,
        self: 0,
        isLowerBound: true,
        children: [
          [
            {  // B.
              title: ['B'],
              total: 65,
              self: 15,
              isLowerBound: true,
              children: [
                [
                  {  // B -> C.
                    title: ['C'],
                    total: 10,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        {  // B -> C -> D.
                          title: ['D'],
                          total: 5,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            []
                          ]
                        }
                      ]
                    ]
                  },
                  {  // B -> D.
                    title: ['D'],
                    total: 40,
                    self: 40,
                    isLowerBound: true,
                    children: [
                      []
                    ]
                  }
                ]
              ]
            },
            {  // C.
              title: ['C'],
              total: 60,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  {  // C -> D.
                    title: ['D'],
                    total: 5,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      []
                    ]
                  }
                ]
              ]
            },
            {  // D.
              title: ['D'],
              total: 45,
              self: 40,
              isLowerBound: true,
              children: [
                []
              ]
            }
          ]
        ]
      });

  builderTest('oneDimension_protoTitle', 1 /* dimensions */,
      [
        { path: [['__proto__']], value: 45, kind: SELF },
        { path: [['A']], value: 18, kind: SELF },
        { path: [['A', '__proto__']], value: 89, kind: TOTAL }
      ],
      {  // Tree view.
        title: [undefined],
        total: 152,
        self: 0,
        isLowerBound: true,
        children: [
          [
            {  // __proto__.
              title: ['__proto__'],
              total: 45,
              self: 45,
              isLowerBound: false,
              children: [
                []
              ]
            },
            {  // A.
              title: ['A'],
              total: 107,
              self: 18,
              isLowerBound: false,
              children: [
                [
                  {  // A -> __proto__.
                    title: ['__proto__'],
                    total: 89,
                    self: 0,
                    isLowerBound: false,
                    children: [
                      []
                    ]
                  }
                ]
              ]
            }
          ]
        ]
      },
      {  // Heavy view.
        title: [undefined],
        total: 152,
        self: 0,
        isLowerBound: true,
        children: [
          [
            {  // __proto__.
              title: ['__proto__'],
              total: 134,
              self: 45,
              isLowerBound: true,
              children: [
                []
              ]
            },
            {  // A.
              title: ['A'],
              total: 107,
              self: 18,
              isLowerBound: true,
              children: [
                [
                  {  // A -> __proto__.
                    title: ['__proto__'],
                    total: 89,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      []
                    ]
                  }
                ]
              ]
            }
          ]
        ]
      });

  // See tracing/tracing/base/multi_dimensional_view.html
  // (MultiDimensionalViewBuilder.addDimensionsToHeavyViewNode_ documentation).
  builderTest('oneDimension_documentationExample', 1 /* dimensions */,
      [
        { path: [['A']], value: 10, kind: SELF },
        { path: [['A']], value: 30, kind: TOTAL },
        { path: [['A', 'B']], value: 1, kind: SELF },
        { path: [['A', 'B', 'A']], value: 3, kind: SELF },
        { path: [['A', 'B', 'A']], value: 8, kind: TOTAL },
        { path: [['A', 'B', 'C']], value: 2, kind: SELF },
        { path: [['A', 'B', 'C']], value: 7, kind: TOTAL },
        { path: [['B']], value: 12, kind: SELF },
        { path: [['B']], value: 18, kind: TOTAL }
      ],
      {  // Tree view.
        title: [undefined],
        total: 48,
        self: 0,
        isLowerBound: true,
        children: [
          [
            {  // A.
              title: ['A'],
              total: 30,
              self: 10,
              isLowerBound: false,
              children: [
                [
                  {  // A -> B.
                    title: ['B'],
                    total: 16,
                    self: 1,
                    isLowerBound: false,
                    children: [
                      [
                        {  // A -> B -> A.
                          title: ['A'],
                          total: 8,
                          self: 3,
                          isLowerBound: false,
                          children: [
                            []
                          ]
                        },
                        {  // A -> B -> C.
                          title: ['C'],
                          total: 7,
                          self: 2,
                          isLowerBound: false,
                          children: [
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ]
              ]
            },
            {  // B.
              title: ['B'],
              total: 18,
              self: 12,
              isLowerBound: false,
              children: [
                []
              ]
            }
          ]
        ]
      },
      {  // Heavy view.
        title: [undefined],
        total: 48,
        self: 0,
        isLowerBound: true,
        children: [
          [
            {  // A.
              title: ['A'],
              total: 30,
              self: 13,
              isLowerBound: true,
              children: [
                [
                  {  // A -> B.
                    title: ['B'],
                    total: 16,
                    self: 1,
                    isLowerBound: true,
                    children: [
                      [
                        {  // A -> B -> A.
                          title: ['A'],
                          total: 8,
                          self: 3,
                          isLowerBound: true,
                          children: [
                            []
                          ]
                        },
                        {  // A -> B -> C.
                          title: ['C'],
                          total: 7,
                          self: 2,
                          isLowerBound: true,
                          children: [
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ]
              ]
            },
            {  // B.
              title: ['B'],
              total: 34,
              self: 13,
              isLowerBound: true,
              children: [
                [
                  {  // B -> A.
                    title: ['A'],
                    total: 8,
                    self: 3,
                    isLowerBound: true,
                    children: [
                      []
                    ]
                  },
                  {  // B -> C.
                    title: ['C'],
                    total: 7,
                    self: 2,
                    isLowerBound: true,
                    children: [
                      []
                    ]
                  }
                ]
              ]
            },
            {  // C.
              title: ['C'],
              total: 7,
              self: 2,
              isLowerBound: true,
              children: [
                []
              ]
            }
          ]
        ]
      });

  builderTest('twoDimensions_noPaths', 2 /* dimensions */,
      [],
      {  // Tree view.
        title: [undefined, undefined],
        total: 0,
        self: 0,
        isLowerBound: true,
        children: [
          [],
          []
        ]
      },
      {  // Heavy view.
        title: [undefined, undefined],
        total: 0,
        self: 0,
        isLowerBound: true,
        children: [
          [],
          []
        ]
      });

  // See tracing/tracing/base/multi_dimensional_view.html
  // (MultiDimensionalViewNode.finalizeTotalValues_ documentation).
  builderTest('twoDimensions_totalCalculation', 2 /* dimensions */,
      [
        { path: [[], []], value: 10, kind: SELF },
        { path: [['A'], []], value: 21, kind: SELF },
        { path: [['A'], []], value: 30, kind: TOTAL },
        { path: [['B'], []], value: 25, kind: SELF },
        { path: [['B'], []], value: 32, kind: TOTAL },
        { path: [[], ['1']], value: 3, kind: SELF },
        { path: [[], ['1']], value: 15, kind: TOTAL },
        { path: [[], ['2']], value: 40, kind: SELF },
        { path: [[], ['2']], value: 41, kind: TOTAL }
      ],
      {  // Tree view.
        title: [undefined, undefined],
        total: 115,
        self: 10,
        isLowerBound: false,
        children: [
          [
            {  // A, *.
              title: ['A', undefined],
              total: 30,
              self: 21,
              isLowerBound: false,
              children: [
                [],
                []
              ]
            },
            {  // B, *.
              title: ['B', undefined],
              total: 32,
              self: 25,
              isLowerBound: false,
              children: [
                [],
                []
              ]
            }
          ],
          [
            {  // *, 1.
              title: [undefined, '1'],
              total: 15,
              self: 3,
              isLowerBound: false,
              children: [
                [],
                []
              ]
            },
            {  // *, 2.
              title: [undefined, '2'],
              total: 41,
              self: 40,
              isLowerBound: false,
              children: [
                [],
                []
              ]
            }
          ]
        ]
      },
      {  // Heavy view.
        title: [undefined, undefined],
        total: 115,
        self: 10,
        isLowerBound: false,
        children: [
          [
            {  // A, *.
              title: ['A', undefined],
              total: 30,
              self: 21,
              isLowerBound: true,
              children: [
                [],
                []
              ]
            },
            {  // B, *.
              title: ['B', undefined],
              total: 32,
              self: 25,
              isLowerBound: true,
              children: [
                [],
                []
              ]
            }
          ],
          [
            {  // *, 1.
              title: [undefined, '1'],
              total: 15,
              self: 3,
              isLowerBound: true,
              children: [
                [],
                []
              ]
            },
            {  // *, 2.
              title: [undefined, '2'],
              total: 41,
              self: 40,
              isLowerBound: true,
              children: [
                [],
                []
              ]
            }
          ]
        ]
      });

  // See tracing/tracing/base/multi_dimensional_view.html
  // (MultiDimensionalViewNode documentation).
  builderTest('twoDimensions_documentationExample1', 2 /* dimensions */,
      [
        { path: [['A', 'B'], ['T1', 'T2']], value: 1, kind: TOTAL },
        { path: [['A', 'B'], ['T1']], value: 2, kind: TOTAL },
        { path: [['A', 'B'], []], value: 4, kind: TOTAL },
        { path: [['A'], ['T1', 'T2']], value: 10, kind: TOTAL },
        { path: [['A'], ['T1']], value: 20, kind: TOTAL },
        { path: [['A'], []], value: 40, kind: TOTAL },
        { path: [[], ['T1', 'T2']], value: 100, kind: TOTAL },
        { path: [[], ['T1']], value: 200, kind: TOTAL },
        { path: [[], []], value: 400, kind: TOTAL }
      ],
      {  // Tree view.
        title: [undefined, undefined],
        total: 400,
        self: 0,
        isLowerBound: false,
        children: [
          [
            {  // A, *.
              title: ['A', undefined],
              total: 40,
              self: 0,
              isLowerBound: false,
              children: [
                [
                  {  // A -> B, *.
                    title: ['B', undefined],
                    total: 4,
                    self: 0,
                    isLowerBound: false,
                    children: [
                      [],
                      [
                        {  // A -> B, T1.
                          id: '#0',
                          title: ['B', 'T1'],
                          total: 2,
                          self: 0,
                          isLowerBound: false,
                          children: [
                            [],
                            [
                              {  // A -> B, T1 -> T2.
                                id: '#1',
                                title: ['B', 'T2'],
                                total: 1,
                                self: 0,
                                isLowerBound: false,
                                children: [
                                  [],
                                  []
                                ]
                              }
                            ]
                          ]
                        }
                      ]
                    ]
                  }
                ],
                [
                  {  // A, T1.
                    id: '#2',
                    title: ['A', 'T1'],
                    total: 20,
                    self: 0,
                    isLowerBound: false,
                    children: [
                      [
                        '#0'  // A -> B, T1.
                      ],
                      [
                        {  // A, T1 -> T2.
                          id: '#3',
                          title: ['A', 'T2'],
                          total: 10,
                          self: 0,
                          isLowerBound: false,
                          children: [
                            [
                              '#1'  // A -> B, T1 -> T2.
                            ],
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ]
              ]
            }
          ],
          [
            {  // *, T1.
              title: [undefined, 'T1'],
              total: 200,
              self: 0,
              isLowerBound: false,
              children: [
                [
                  '#2'  // A, T1.
                ],
                [
                  {  // *, T1 -> T2.
                    title: [undefined, 'T2'],
                    total: 100,
                    self: 0,
                    isLowerBound: false,
                    children: [
                      [
                        '#3'  // A, T1 -> T2.
                      ],
                      []
                    ]
                  }
                ]
              ]
            }
          ]
        ]
      },
      {  // Heavy view.
        title: [undefined, undefined],
        total: 400,
        self: 0,
        isLowerBound: false,
        children: [
          [
            {  // A, *.
              title: ['A', undefined],
              total: 40,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  {  // A -> B, *.
                    title: ['B', undefined],
                    total: 4,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [],
                      [
                        {  // A -> B, T1.
                          id: '#0',
                          title: ['B', 'T1'],
                          total: 2,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [],
                            [
                              {  // A -> B, T1 -> T2.
                                id: '#1',
                                title: ['B', 'T2'],
                                total: 1,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [],
                                  []
                                ]
                              }
                            ]
                          ]
                        },
                        {  // A -> B, T2.
                          id: '#2',
                          title: ['B', 'T2'],
                          total: 1,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [],
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ],
                [
                  {  // A, T1.
                    id: '#3',
                    title: ['A', 'T1'],
                    total: 20,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#0'  // A -> B, T1.
                      ],
                      [
                        {  // A, T1 -> T2.
                          id: '#4',
                          title: ['A', 'T2'],
                          total: 10,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [
                              '#1'  // A -> B, T1 -> T2.
                            ],
                            []
                          ]
                        }
                      ]
                    ]
                  },
                  {  // A, T2.
                    id: '#5',
                    title: ['A', 'T2'],
                    total: 10,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#2'  // A -> B, T2.
                      ],
                      []
                    ]
                  }
                ]
              ]
            },
            {  // B, *.
              title: ['B', undefined],
              total: 4,
              self: 0,
              isLowerBound: true,
              children: [
                [],
                [
                  {  // B, T1.
                    id: '#6',
                    title: ['B', 'T1'],
                    total: 2,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [],
                      [
                        {  // B, T1 -> T2.
                          id: '#7',
                          title: ['B', 'T2'],
                          total: 1,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [],
                            []
                          ]
                        }
                      ]
                    ]
                  },
                  {  // B, T2.
                    id: '#8',
                    title: ['B', 'T2'],
                    total: 1,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [],
                      []
                    ]
                  }
                ]
              ]
            }
          ],
          [
            {  // *, T1.
              title: [undefined, 'T1'],
              total: 200,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  '#3',  // A, T1.
                  '#6'  // B, T1.
                ],
                [
                  {  // *, T1 -> T2.
                    title: [undefined, 'T2'],
                    total: 100,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#4',  // A, T1 -> T2.
                        '#7'  // B, T1 -> T2.
                      ],
                      []
                    ]
                  }
                ]
              ]
            },
            {  // *, T2.
              title: [undefined, 'T2'],
              total: 100,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  '#5',  // A, T2.
                  '#8'  // B, T2.
                ],
                []
              ]
            }
          ]
        ]
      });

  // See tracing/tracing/base/multi_dimensional_view.html
  // (MultiDimensionalViewBuilder documentation).
  builderTest('twoDimensions_documentationExample2', 2 /* dimensions */,
      [
        { path: [['Saturday'], ['Cooking']], value: 1, kind: SELF },
        { path: [['Saturday'], ['Sports', 'Football']], value: 2, kind: SELF },
        { path: [['Sunday'], ['Sports', 'Basketball']], value: 3, kind: SELF }
      ],
      {  // Tree view.
        title: [undefined, undefined],
        total: 6,
        self: 0,
        isLowerBound: true,
        children: [
          [
            {  // Saturday, *.
              title: ['Saturday', undefined],
              total: 3,
              self: 0,
              isLowerBound: true,
              children: [
                [],
                [
                  {  // Saturday, Cooking.
                    id: '#0',
                    title: ['Saturday', 'Cooking'],
                    total: 1,
                    self: 1,
                    isLowerBound: false,
                    children: [
                      [],
                      []
                    ]
                  },
                  {  // Saturday, Sports.
                    id: '#1',
                    title: ['Saturday', 'Sports'],
                    total: 2,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [],
                      [
                        {  // Saturday, Sports -> Football.
                          id: '#2',
                          title: ['Saturday', 'Football'],
                          total: 2,
                          self: 2,
                          isLowerBound: false,
                          children: [
                            [],
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ]
              ]
            },
            {  // Sunday, *.
              title: ['Sunday', undefined],
              total: 3,
              self: 0,
              isLowerBound: true,
              children: [
                [],
                [
                  {  // Sunday, Sports.
                    id: '#3',
                    title: ['Sunday', 'Sports'],
                    total: 3,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [],
                      [
                        {  // Sunday, Sports -> Basketball.
                          id: '#4',
                          title: ['Sunday', 'Basketball'],
                          total: 3,
                          self: 3,
                          isLowerBound: false,
                          children: [
                            [],
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ]
              ]
            }
          ],
          [
            {  // *, Cooking.
              title: [undefined, 'Cooking'],
              total: 1,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  '#0'  // Saturday, Cooking.
                ],
                []
              ]
            },
            {  // *, Sports.
              title: [undefined, 'Sports'],
              total: 5,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  '#1',  // Saturday, Sports.
                  '#3'  // Sunday, Sports.
                ],
                [
                  {  // *, Sports -> Football.
                    title: [undefined, 'Football'],
                    total: 2,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#2'  // Saturday, Sports -> Football.
                      ],
                      []
                    ]
                  },
                  {  // *, Sports -> Basketball.
                    title: [undefined, 'Basketball'],
                    total: 3,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#4'  // Sunday, Sports -> Basketball.
                      ],
                      []
                    ]
                  }
                ]
              ]
            }
          ]
        ]
      },
      {  // Heavy view.
        title: [undefined, undefined],
        total: 6,
        self: 0,
        isLowerBound: true,
        children: [
          [
            {  // Saturday, *.
              title: ['Saturday', undefined],
              total: 3,
              self: 0,
              isLowerBound: true,
              children: [
                [],
                [
                  {  // Saturday, Cooking.
                    id: '#0',
                    title: ['Saturday', 'Cooking'],
                    total: 1,
                    self: 1,
                    isLowerBound: true,
                    children: [
                      [],
                      []
                    ]
                  },
                  {  // Saturday, Sports.
                    id: '#1',
                    title: ['Saturday', 'Sports'],
                    total: 2,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [],
                      [
                        {  // Saturday, Sports -> Football.
                          id: '#2',
                          title: ['Saturday', 'Football'],
                          total: 2,
                          self: 2,
                          isLowerBound: true,
                          children: [
                            [],
                            []
                          ]
                        }
                      ]
                    ]
                  },
                  {  // Saturday, Football.
                    id: '#3',
                    title: ['Saturday', 'Football'],
                    total: 2,
                    self: 2,
                    isLowerBound: true,
                    children: [
                      [],
                      []
                    ]
                  }
                ]
              ]
            },
            {  // Sunday, *.
              title: ['Sunday', undefined],
              total: 3,
              self: 0,
              isLowerBound: true,
              children: [
                [],
                [
                  {  // Sunday, Sports.
                    id: '#4',
                    title: ['Sunday', 'Sports'],
                    total: 3,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [],
                      [
                        {  // Sunday, Sports -> Basketball.
                          id: '#5',
                          title: ['Sunday', 'Basketball'],
                          total: 3,
                          self: 3,
                          isLowerBound: true,
                          children: [
                            [],
                            []
                          ]
                        }
                      ]
                    ]
                  },
                  {  // Sunday, Basketball.
                    id: '#6',
                    title: ['Sunday', 'Basketball'],
                    total: 3,
                    self: 3,
                    isLowerBound: true,
                    children: [
                      [],
                      []
                    ]
                  }
                ]
              ]
            }
          ],
          [
            {  // *, Cooking.
              title: [undefined, 'Cooking'],
              total: 1,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  '#0'  // Saturday, Cooking.
                ],
                []
              ]
            },
            {  // *, Sports.
              title: [undefined, 'Sports'],
              total: 5,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  '#1',  // Saturday, Sports.
                  '#4'  // Sunday, Sports.
                ],
                [
                  {  // *, Sports -> Football.
                    title: [undefined, 'Football'],
                    total: 2,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#2'  // Saturday, Sports -> Football.
                      ],
                      []
                    ]
                  },
                  {  // *, Sports -> Basketball.
                    title: [undefined, 'Basketball'],
                    total: 3,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#5'  // Sunday, Sports -> Basketball.
                      ],
                      []
                    ]
                  }
                ]
              ]
            },
            {  // *, Football.
              title: [undefined, 'Football'],
              total: 2,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  '#3'  // Saturday, Football.
                ],
                []
              ]
            },
            {  // *, Basketball.
              title: [undefined, 'Basketball'],
              total: 3,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  '#6'  // Sunday, Basketball.
                ],
                []
              ]
            }
          ]
        ]
      });

  // See https://goo.gl/KY7zVE.
  builderTest('twoDimensions_heapDumpExample', 2 /* dimensions */,
      [
        { path: [['BrMain', 'Init'], ['T']], value: 151, kind: TOTAL },
        { path: [['BrMain', 'Init'], ['W']], value: 83, kind: TOTAL },
        { path: [['BrMain', 'Init'], []], value: 242, kind: TOTAL },
        { path: [['BrMain', 'MsgLp'], ['T']], value: 307, kind: TOTAL },
        { path: [['BrMain', 'MsgLp'], ['V']], value: 281, kind: TOTAL },
        { path: [['BrMain', 'MsgLp'], []], value: 601, kind: TOTAL },
        { path: [['RdMain', 'RTask'], ['T']], value: 211, kind: TOTAL },
        { path: [['RdMain', 'RTask'], ['W']], value: 337, kind: TOTAL },
        { path: [['RdMain', 'RTask'], []], value: 556, kind: TOTAL },
        { path: [[], ['T']], value: 698, kind: TOTAL },
        { path: [[], ['V']], value: 340, kind: TOTAL },
        { path: [[], ['W']], value: 461, kind: TOTAL },
        { path: [[], []], value: 1538, kind: TOTAL },
        { path: [['BrMain'], ['T']], value: 465, kind: TOTAL },
        { path: [['BrMain'], ['V']], value: 297, kind: TOTAL },
        { path: [['BrMain'], ['W']], value: 96, kind: TOTAL },
        { path: [['BrMain'], []], value: 876, kind: TOTAL },
        { path: [['RdMain'], ['T']], value: 229, kind: TOTAL },
        { path: [['RdMain'], ['W']], value: 355, kind: TOTAL },
        { path: [['RdMain'], []], value: 628, kind: TOTAL }
      ],
      {  // Tree view.
        title: [undefined, undefined],
        total: 1538,
        self: 0,
        isLowerBound: false,
        children: [
          [
            {  // BrMain, *.
              title: ['BrMain', undefined],
              total: 876,
              self: 0,
              isLowerBound: false,
              children: [
                [
                  {  // BrMain -> Init, *.
                    title: ['Init', undefined],
                    total: 242,
                    self: 0,
                    isLowerBound: false,
                    children: [
                      [],
                      [
                        {  // BrMain -> Init, T.
                          id: '#0',
                          title: ['Init', 'T'],
                          total: 151,
                          self: 0,
                          isLowerBound: false,
                          children: [
                            [],
                            []
                          ]
                        },
                        {  // BrMain -> Init, W.
                          id: '#1',
                          title: ['Init', 'W'],
                          total: 83,
                          self: 0,
                          isLowerBound: false,
                          children: [
                            [],
                            []
                          ]
                        }
                      ]
                    ]
                  },
                  {  // BrMain -> MsgLp, *.
                    title: ['MsgLp', undefined],
                    total: 601,
                    self: 0,
                    isLowerBound: false,
                    children: [
                      [],
                      [
                        {  // BrMain -> MsgLp, T.
                          id: '#2',
                          title: ['MsgLp', 'T'],
                          total: 307,
                          self: 0,
                          isLowerBound: false,
                          children: [
                            [],
                            []
                          ]
                        },
                        {  // BrMain -> MsgLp, V.
                          id: '#3',
                          title: ['MsgLp', 'V'],
                          total: 281,
                          self: 0,
                          isLowerBound: false,
                          children: [
                            [],
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ],
                [
                  {  // BrMain, T.
                    id: '#4',
                    title: ['BrMain', 'T'],
                    total: 465,
                    self: 0,
                    isLowerBound: false,
                    children: [
                      [
                        '#0',  // BrMain -> Init, T.
                        '#2'  // BrMain -> MsgLp, T.
                      ],
                      []
                    ]
                  },
                  {  // BrMain, V.
                    id: '#5',
                    title: ['BrMain', 'V'],
                    total: 297,
                    self: 0,
                    isLowerBound: false,
                    children: [
                      [
                        '#3'  // BrMain -> MsgLp, V.
                      ],
                      []
                    ]
                  },
                  {  // BrMain, W.
                    id: '#6',
                    title: ['BrMain', 'W'],
                    total: 96,
                    self: 0,
                    isLowerBound: false,
                    children: [
                      [
                        '#1'  // BrMain -> Init, W.
                      ],
                      []
                    ]
                  }
                ]
              ]
            },
            {  // RdMain, *.
              title: ['RdMain', undefined],
              total: 628,
              self: 0,
              isLowerBound: false,
              children: [
                [
                  {  // RdMain -> RTask, *.
                    title: ['RTask', undefined],
                    total: 556,
                    self: 0,
                    isLowerBound: false,
                    children: [
                      [],
                      [
                        {  // RdMain -> RTask, T.
                          id: '#7',
                          title: ['RTask', 'T'],
                          total: 211,
                          self: 0,
                          isLowerBound: false,
                          children: [
                            [],
                            []
                          ]
                        },
                        {  // RdMain -> RTask, W.
                          id: '#8',
                          title: ['RTask', 'W'],
                          total: 337,
                          self: 0,
                          isLowerBound: false,
                          children: [
                            [],
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ],
                [
                  {  // RdMain, T.
                    id: '#9',
                    title: ['RdMain', 'T'],
                    total: 229,
                    self: 0,
                    isLowerBound: false,
                    children: [
                      [
                        '#7'  // RdMain -> RTask, T.
                      ],
                      []
                    ]
                  },
                  {  // RdMain, W.
                    id: '#10',
                    title: ['RdMain', 'W'],
                    total: 355,
                    self: 0,
                    isLowerBound: false,
                    children: [
                      [
                        '#8'  // RdMain -> RTask, W.
                      ],
                      []
                    ]
                  }
                ]
              ]
            }
          ],
          [
            {  // *, T.
              title: [undefined, 'T'],
              total: 698,
              self: 0,
              isLowerBound: false,
              children: [
                [
                  '#4',  // BrMain, T.
                  '#9'  // RdMain, T.
                ],
                []
              ]
            },
            {  // *, V.
              title: [undefined, 'V'],
              total: 340,
              self: 0,
              isLowerBound: false,
              children: [
                [
                  '#5'  // BrMain, V.
                ],
                []
              ]
            },
            {  // *, W.
              title: [undefined, 'W'],
              total: 461,
              self: 0,
              isLowerBound: false,
              children: [
                [
                  '#6',  // BrMain, W.
                  '#10'  // RdMain, W.
                ],
                []
              ]
            }
          ]
        ]
      },
      {  // Heavy view.
        title: [undefined, undefined],
        total: 1538,
        self: 0,
        isLowerBound: false,
        children: [
          [
            {  // BrMain, *.
              title: ['BrMain', undefined],
              total: 876,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  {  // BrMain -> Init, *.
                    title: ['Init', undefined],
                    total: 242,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [],
                      [
                        {  // BrMain -> Init, T.
                          id: '#0',
                          title: ['Init', 'T'],
                          total: 151,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [],
                            []
                          ]
                        },
                        {  // BrMain -> Init, W.
                          id: '#1',
                          title: ['Init', 'W'],
                          total: 83,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [],
                            []
                          ]
                        }
                      ]
                    ]
                  },
                  {  // BrMain -> MsgLp, *.
                    title: ['MsgLp', undefined],
                    total: 601,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [],
                      [
                        {  // BrMain -> MsgLp, T.
                          id: '#2',
                          title: ['MsgLp', 'T'],
                          total: 307,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [],
                            []
                          ]
                        },
                        {  // BrMain -> MsgLp, V.
                          id: '#3',
                          title: ['MsgLp', 'V'],
                          total: 281,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [],
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ],
                [
                  {  // BrMain, T.
                    id: '#4',
                    title: ['BrMain', 'T'],
                    total: 465,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#0',  // BrMain -> Init, T.
                        '#2'  // BrMain -> MsgLp, T.
                      ],
                      []
                    ]
                  },
                  {  // BrMain, V.
                    id: '#5',
                    title: ['BrMain', 'V'],
                    total: 297,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#3'  // BrMain -> MsgLp, V.
                      ],
                      []
                    ]
                  },
                  {  // BrMain, W.
                    id: '#6',
                    title: ['BrMain', 'W'],
                    total: 96,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#1'  // BrMain -> Init, W.
                      ],
                      []
                    ]
                  }
                ]
              ]
            },
            {  // Init, *.
              title: ['Init', undefined],
              total: 242,
              self: 0,
              isLowerBound: true,
              children: [
                [],
                [
                  {  // Init, T.
                    id: '#7',
                    title: ['Init', 'T'],
                    total: 151,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [],
                      []
                    ]
                  },
                  {  // Init, W.
                    id: '#8',
                    title: ['Init', 'W'],
                    total: 83,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [],
                      []
                    ]
                  }
                ]
              ]
            },
            {  // MsgLp, *.
              title: ['MsgLp', undefined],
              total: 601,
              self: 0,
              isLowerBound: true,
              children: [
                [],
                [
                  {  // MsgLp, T.
                    id: '#9',
                    title: ['MsgLp', 'T'],
                    total: 307,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [],
                      []
                    ]
                  },
                  {  // MsgLp, V.
                    id: '#10',
                    title: ['MsgLp', 'V'],
                    total: 281,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [],
                      []
                    ]
                  }
                ]
              ]
            },
            {  // RdMain, *.
              title: ['RdMain', undefined],
              total: 628,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  {  // RdMain -> RTask, *.
                    title: ['RTask', undefined],
                    total: 556,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [],
                      [
                        {  // RdMain -> RTask, T.
                          id: '#11',
                          title: ['RTask', 'T'],
                          total: 211,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [],
                            []
                          ]
                        },
                        {  // RdMain -> RTask, W.
                          id: '#12',
                          title: ['RTask', 'W'],
                          total: 337,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [],
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ],
                [
                  {  // RdMain, T.
                    id: '#13',
                    title: ['RdMain', 'T'],
                    total: 229,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#11'  // RdMain -> RTask, T.
                      ],
                      []
                    ]
                  },
                  {  // RdMain, W.
                    id: '#14',
                    title: ['RdMain', 'W'],
                    total: 355,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#12'  // RdMain -> RTask, W.
                      ],
                      []
                    ]
                  }
                ]
              ]
            },
            {  // RTask, *.
              title: ['RTask', undefined],
              total: 556,
              self: 0,
              isLowerBound: true,
              children: [
                [],
                [
                  {  // RTask, T.
                    id: '#15',
                    title: ['RTask', 'T'],
                    total: 211,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [],
                      []
                    ]
                  },
                  {  // RTask, W.
                    id: '#16',
                    title: ['RTask', 'W'],
                    total: 337,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [],
                      []
                    ]
                  }
                ]
              ]
            }
          ],
          [
            {  // *, T.
              title: [undefined, 'T'],
              total: 698,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  '#4',  // BrMain, T.
                  '#7',  // Init, T.
                  '#9',  // MsgLp, T.
                  '#13',  // RdMain, T.
                  '#15'  // RTask, T.
                ],
                []
              ]
            },
            {  // *, V.
              title: [undefined, 'V'],
              total: 340,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  '#5',  // BrMain, V.
                  '#10'  // MsgLp, V.
                ],
                []
              ]
            },
            {  // *, W.
              title: [undefined, 'W'],
              total: 461,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  '#6',  // BrMain, W.
                  '#8',  // Init, W.
                  '#14',  // RdMain, W.
                  '#16'  // RTask, W.
                ],
                []
              ]
            }
          ]
        ]
      });

  builderTest('twoDimensions_oneRecursiveDimension', 2 /* dimensions */,
      [
        { path: [['A', 'B'], []], value: 1500, kind: TOTAL },
        { path: [['A', 'B', 'A'], []], value: 200, kind: TOTAL },
        { path: [['A', 'B', 'B'], []], value: 300, kind: TOTAL },
        { path: [['A', 'B', 'C'], []], value: 700, kind: TOTAL },
        { path: [['A', 'B'], ['T1']], value: 15, kind: TOTAL },
        { path: [['A', 'B', 'A'], ['T1']], value: 2, kind: TOTAL },
        { path: [['A', 'B', 'B'], ['T1']], value: 3, kind: TOTAL },
        { path: [['A', 'B', 'C'], ['T1']], value: 7, kind: TOTAL },
        { path: [['B', 'A'], ['T1']], value: 30000, kind: TOTAL },
        { path: [['B', 'A'], []], value: 40000, kind: TOTAL }
      ],
      {  // Tree view.
        title: [undefined, undefined],
        total: 41500,
        self: 0,
        isLowerBound: true,
        children: [
          [
            {  // A, *.
              title: ['A', undefined],
              total: 1500,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  {  // A -> B, *.
                    title: ['B', undefined],
                    total: 1500,
                    self: 0,
                    isLowerBound: false,
                    children: [
                      [
                        {  // A -> B -> A, *.
                          title: ['A', undefined],
                          total: 200,
                          self: 0,
                          isLowerBound: false,
                          children: [
                            [],
                            [
                              {  // A -> B -> A, T1.
                                id: '#0',
                                title: ['A', 'T1'],
                                total: 2,
                                self: 0,
                                isLowerBound: false,
                                children: [
                                  [],
                                  []
                                ]
                              }
                            ]
                          ]
                        },
                        {  // A -> B -> B, *.
                          title: ['B', undefined],
                          total: 300,
                          self: 0,
                          isLowerBound: false,
                          children: [
                            [],
                            [
                              {  // A -> B -> B, T1.
                                id: '#1',
                                title: ['B', 'T1'],
                                total: 3,
                                self: 0,
                                isLowerBound: false,
                                children: [
                                  [],
                                  []
                                ]
                              }
                            ]
                          ]
                        },
                        {  // A -> B -> C, *.
                          title: ['C', undefined],
                          total: 700,
                          self: 0,
                          isLowerBound: false,
                          children: [
                            [],
                            [
                              {  // A -> B -> C, T1.
                                id: '#2',
                                title: ['C', 'T1'],
                                total: 7,
                                self: 0,
                                isLowerBound: false,
                                children: [
                                  [],
                                  []
                                ]
                              }
                            ]
                          ]
                        }
                      ],
                      [
                        {  // A -> B, T1.
                          id: '#3',
                          title: ['B', 'T1'],
                          total: 15,
                          self: 0,
                          isLowerBound: false,
                          children: [
                            [
                              '#0',  // A -> B -> A, T1.
                              '#1',  // A -> B -> B, T1.
                              '#2'  // A -> B -> C, T1.
                            ],
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ],
                [
                  {  // A, T1.
                    id: '#4',
                    title: ['A', 'T1'],
                    total: 15,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#3'  // A -> B, T1.
                      ],
                      []
                    ]
                  }
                ]
              ]
            },
            {  // B, *.
              title: ['B', undefined],
              total: 40000,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  {  // B -> A, *.
                    title: ['A', undefined],
                    total: 40000,
                    self: 0,
                    isLowerBound: false,
                    children: [
                      [],
                      [
                        {  // B -> A, T1.
                          id: '#5',
                          title: ['A', 'T1'],
                          total: 30000,
                          self: 0,
                          isLowerBound: false,
                          children: [
                            [],
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ],
                [
                  {  // B, T1.
                    id: '#6',
                    title: ['B', 'T1'],
                    total: 30000,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#5'  // B -> A, T1.
                      ],
                      []
                    ]
                  }
                ]
              ]
            }
          ],
          [
            {  // *, T1.
              title: [undefined, 'T1'],
              total: 30015,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  '#4',  // A, T1.
                  '#6'  // B, T1.
                ],
                []
              ]
            }
          ]
        ]
      },
      {  // Heavy view.
        title: [undefined, undefined],
        total: 41500,
        self: 0,
        isLowerBound: true,
        children: [
          [
            {  // A, *.
              title: ['A', undefined],
              total: 41500,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  {  // A -> B, *.
                    title: ['B', undefined],
                    total: 1500,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        {  // A -> B -> A, *.
                          title: ['A', undefined],
                          total: 200,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [],
                            [
                              {  // A -> B -> A, T1.
                                id: '#0',
                                title: ['A', 'T1'],
                                total: 2,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [],
                                  []
                                ]
                              }
                            ]
                          ]
                        },
                        {  // A -> B -> B, *.
                          title: ['B', undefined],
                          total: 300,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [],
                            [
                              {  // A -> B -> B, T1.
                                id: '#1',
                                title: ['B', 'T1'],
                                total: 3,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [],
                                  []
                                ]
                              }
                            ]
                          ]
                        },
                        {  // A -> B -> C, *.
                          title: ['C', undefined],
                          total: 700,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [],
                            [
                              {  // A -> B -> C, T1.
                                id: '#2',
                                title: ['C', 'T1'],
                                total: 7,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [],
                                  []
                                ]
                              }
                            ]
                          ]
                        }
                      ],
                      [
                        {  // A -> B, T1.
                          id: '#3',
                          title: ['B', 'T1'],
                          total: 15,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [
                              '#0',  // A -> B -> A, T1.
                              '#1',  // A -> B -> B, T1.
                              '#2'  // A -> B -> C, T1.
                            ],
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ],
                [
                  {  // A, T1.
                    id: '#4',
                    title: ['A', 'T1'],
                    total: 30015,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#3'  // A -> B, T1.
                      ],
                      []
                    ]
                  }
                ]
              ]
            },
            {  // B, *.
              title: ['B', undefined],
              total: 41500,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  {  // B -> A, *.
                    title: ['A', undefined],
                    total: 40200,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [],
                      [
                        {  // B -> A, T1.
                          id: '#5',
                          title: ['A', 'T1'],
                          total: 30002,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [],
                            []
                          ]
                        }
                      ]
                    ]
                  },
                  {  // B -> B, *.
                    title: ['B', undefined],
                    total: 300,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [],
                      [
                        {  // B -> B, T1.
                          id: '#6',
                          title: ['B', 'T1'],
                          total: 3,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [],
                            []
                          ]
                        }
                      ]
                    ]
                  },
                  {  // B -> C, *.
                    title: ['C', undefined],
                    total: 700,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [],
                      [
                        {  // B -> C, T1.
                          id: '#7',
                          title: ['C', 'T1'],
                          total: 7,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [],
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ],
                [
                  {  // B, T1.
                    id: '#8',
                    title: ['B', 'T1'],
                    total: 30015,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#5',  // B -> A, T1.
                        '#6',  // B -> B, T1.
                        '#7'  // B -> C, T1.
                      ],
                      []
                    ]
                  }
                ]
              ]
            },
            {  // C, *.
              title: ['C', undefined],
              total: 700,
              self: 0,
              isLowerBound: true,
              children: [
                [],
                [
                  {  // C, T1.
                    id: '#9',
                    title: ['C', 'T1'],
                    total: 7,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [],
                      []
                    ]
                  }
                ]
              ]
            }
          ],
          [
            {  // *, T1.
              title: [undefined, 'T1'],
              total: 30015,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  '#4',  // A, T1.
                  '#8',  // B, T1.
                  '#9'  // C, T1.
                ],
                []
              ]
            }
          ]
        ]
      });

  builderTest('twoDimensions_twoRecursiveDimensions', 2 /* dimensions */,
      [
        { path: [['A', 'A', 'B'], ['1', '2', '2']], value: 10, kind: SELF },
        { path: [['A', 'A'], ['1', '2']], value: 40, kind: TOTAL },
        { path: [['A', 'B', 'B'], ['1', '1', '2']], value: 20, kind: TOTAL },
        { path: [['A', 'B'], ['1', '1']], value: 5, kind: SELF }
      ],
      {  // Tree view.
        title: [undefined, undefined],
        total: 65,
        self: 0,
        isLowerBound: true,
        children: [
          [
            {  // A, *.
              title: ['A', undefined],
              total: 65,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  {  // A -> A, *.
                    title: ['A', undefined],
                    total: 40,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        {  // A -> A -> B, *.
                          title: ['B', undefined],
                          total: 10,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [],
                            [
                              {  // A -> A -> B, 1.
                                id: '#0',
                                title: ['B', '1'],
                                total: 10,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [],
                                  [
                                    {  // A -> A -> B, 1 -> 2.
                                      id: '#1',
                                      title: ['B', '2'],
                                      total: 10,
                                      self: 0,
                                      isLowerBound: true,
                                      children: [
                                        [],
                                        [
                                          {  // A -> A -> B, 1 -> 2 -> 2.
                                            id: '#2',
                                            title: ['B', '2'],
                                            total: 10,
                                            self: 10,
                                            isLowerBound: false,
                                            children: [
                                              [],
                                              []
                                            ]
                                          }
                                        ]
                                      ]
                                    }
                                  ]
                                ]
                              }
                            ]
                          ]
                        }
                      ],
                      [
                        {  // A -> A, 1.
                          id: '#3',
                          title: ['A', '1'],
                          total: 40,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [
                              '#0'  // A -> A -> B, 1.
                            ],
                            [
                              {  // A -> A, 1 -> 2.
                                id: '#4',
                                title: ['A', '2'],
                                total: 40,
                                self: 0,
                                isLowerBound: false,
                                children: [
                                  [
                                    '#1'  // A -> A -> B, 1 -> 2.
                                  ],
                                  [
                                    {  // A -> A, 1 -> 2 -> 2.
                                      id: '#5',
                                      title: ['A', '2'],
                                      total: 10,
                                      self: 0,
                                      isLowerBound: true,
                                      children: [
                                        [
                                          '#2'  // A -> A -> B, 1 -> 2 -> 2.
                                        ],
                                        []
                                      ]
                                    }
                                  ]
                                ]
                              }
                            ]
                          ]
                        }
                      ]
                    ]
                  },
                  {  // A -> B, *.
                    title: ['B', undefined],
                    total: 25,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        {  // A -> B -> B, *.
                          title: ['B', undefined],
                          total: 20,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [],
                            [
                              {  // A -> B -> B, 1.
                                id: '#6',
                                title: ['B', '1'],
                                total: 20,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [],
                                  [
                                    {  // A -> B -> B, 1 -> 1.
                                      id: '#7',
                                      title: ['B', '1'],
                                      total: 20,
                                      self: 0,
                                      isLowerBound: true,
                                      children: [
                                        [],
                                        [
                                          {  // A -> B -> B, 1 -> 1 -> 2.
                                            id: '#8',
                                            title: ['B', '2'],
                                            total: 20,
                                            self: 0,
                                            isLowerBound: false,
                                            children: [
                                              [],
                                              []
                                            ]
                                          }
                                        ]
                                      ]
                                    }
                                  ]
                                ]
                              }
                            ]
                          ]
                        }
                      ],
                      [
                        {  // A -> B, 1.
                          id: '#9',
                          title: ['B', '1'],
                          total: 25,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [
                              '#6'  // A -> B -> B, 1.
                            ],
                            [
                              {  // A -> B, 1 -> 1.
                                id: '#10',
                                title: ['B', '1'],
                                total: 25,
                                self: 5,
                                isLowerBound: false,
                                children: [
                                  [
                                    '#7'  // A -> B -> B, 1 -> 1.
                                  ],
                                  [
                                    {  // A -> B, 1 -> 1 -> 2.
                                      id: '#11',
                                      title: ['B', '2'],
                                      total: 20,
                                      self: 0,
                                      isLowerBound: true,
                                      children: [
                                        [
                                          '#8'  // A -> B -> B, 1 -> 1 -> 2.
                                        ],
                                        []
                                      ]
                                    }
                                  ]
                                ]
                              }
                            ]
                          ]
                        }
                      ]
                    ]
                  }
                ],
                [
                  {  // A, 1.
                    id: '#12',
                    title: ['A', '1'],
                    total: 65,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#3',  // A -> A, 1.
                        '#9'  // A -> B, 1.
                      ],
                      [
                        {  // A, 1 -> 2.
                          id: '#13',
                          title: ['A', '2'],
                          total: 40,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [
                              '#4'  // A -> A, 1 -> 2.
                            ],
                            [
                              {  // A, 1 -> 2 -> 2.
                                id: '#14',
                                title: ['A', '2'],
                                total: 10,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [
                                    '#5'  // A -> A, 1 -> 2 -> 2.
                                  ],
                                  []
                                ]
                              }
                            ]
                          ]
                        },
                        {  // A, 1 -> 1.
                          id: '#15',
                          title: ['A', '1'],
                          total: 25,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [
                              '#10'  // A -> B, 1 -> 1.
                            ],
                            [
                              {  // A, 1 -> 1 -> 2.
                                id: '#16',
                                title: ['A', '2'],
                                total: 20,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [
                                    '#11'  // A -> B, 1 -> 1 -> 2.
                                  ],
                                  []
                                ]
                              }
                            ]
                          ]
                        }
                      ]
                    ]
                  }
                ]
              ]
            }
          ],
          [
            {  // *, 1.
              title: [undefined, '1'],
              total: 65,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  '#12'  // A, 1.
                ],
                [
                  {  // *, 1 -> 2.
                    title: [undefined, '2'],
                    total: 40,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#13'  // A, 1 -> 2.
                      ],
                      [
                        {  // *, 1 -> 2 -> 2.
                          title: [undefined, '2'],
                          total: 10,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [
                              '#14'  // A, 1 -> 2 -> 2.
                            ],
                            []
                          ]
                        }
                      ]
                    ]
                  },
                  {  // *, 1 -> 1.
                    title: [undefined, '1'],
                    total: 25,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#15'  // A, 1 -> 1.
                      ],
                      [
                        {  // *, 1 -> 1 -> 2.
                          title: [undefined, '2'],
                          total: 20,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [
                              '#16'  // A, 1 -> 1 -> 2.
                            ],
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ]
              ]
            }
          ]
        ]
      },
      {  // Heavy view.
        title: [undefined, undefined],
        total: 65,
        self: 0,
        isLowerBound: true,
        children: [
          [
            {  // A, *.
              title: ['A', undefined],
              total: 65,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  {  // A -> A, *.
                    title: ['A', undefined],
                    total: 40,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        {  // A -> A -> B, *.
                          title: ['B', undefined],
                          total: 10,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [],
                            [
                              {  // A -> A -> B, 1.
                                id: '#0',
                                title: ['B', '1'],
                                total: 10,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [],
                                  [
                                    {  // A -> A -> B, 1 -> 2.
                                      id: '#1',
                                      title: ['B', '2'],
                                      total: 10,
                                      self: 0,
                                      isLowerBound: true,
                                      children: [
                                        [],
                                        [
                                          {  // A -> A -> B, 1 -> 2 -> 2.
                                            id: '#2',
                                            title: ['B', '2'],
                                            total: 10,
                                            self: 10,
                                            isLowerBound: true,
                                            children: [
                                              [],
                                              []
                                            ]
                                          }
                                        ]
                                      ]
                                    }
                                  ]
                                ]
                              },
                              {  // A -> A -> B, 2.
                                id: '#3',
                                title: ['B', '2'],
                                total: 10,
                                self: 10,
                                isLowerBound: true,
                                children: [
                                  [],
                                  [
                                    {  // A -> A -> B, 2 -> 2.
                                      id: '#4',
                                      title: ['B', '2'],
                                      total: 10,
                                      self: 10,
                                      isLowerBound: true,
                                      children: [
                                        [],
                                        []
                                      ]
                                    }
                                  ]
                                ]
                              }
                            ]
                          ]
                        }
                      ],
                      [
                        {  // A -> A, 1.
                          id: '#5',
                          title: ['A', '1'],
                          total: 40,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [
                              '#0'  // A -> A -> B, 1.
                            ],
                            [
                              {  // A -> A, 1 -> 2.
                                id: '#6',
                                title: ['A', '2'],
                                total: 40,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [
                                    '#1'  // A -> A -> B, 1 -> 2.
                                  ],
                                  [
                                    {  // A -> A, 1 -> 2 -> 2.
                                      id: '#7',
                                      title: ['A', '2'],
                                      total: 10,
                                      self: 0,
                                      isLowerBound: true,
                                      children: [
                                        [
                                          '#2'  // A -> A -> B, 1 -> 2 -> 2.
                                        ],
                                        []
                                      ]
                                    }
                                  ]
                                ]
                              }
                            ]
                          ]
                        },
                        {  // A -> A, 2.
                          id: '#8',
                          title: ['A', '2'],
                          total: 40,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [
                              '#3'  // A -> A -> B, 2.
                            ],
                            [
                              {  // A -> A, 2 -> 2.
                                id: '#9',
                                title: ['A', '2'],
                                total: 10,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [
                                    '#4'  // A -> A -> B, 2 -> 2.
                                  ],
                                  []
                                ]
                              }
                            ]
                          ]
                        }
                      ]
                    ]
                  },
                  {  // A -> B, *.
                    title: ['B', undefined],
                    total: 35,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        {  // A -> B -> B, *.
                          title: ['B', undefined],
                          total: 20,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [],
                            [
                              {  // A -> B -> B, 1.
                                id: '#10',
                                title: ['B', '1'],
                                total: 20,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [],
                                  [
                                    {  // A -> B -> B, 1 -> 1.
                                      id: '#11',
                                      title: ['B', '1'],
                                      total: 20,
                                      self: 0,
                                      isLowerBound: true,
                                      children: [
                                        [],
                                        [
                                          {  // A -> B -> B, 1 -> 1 -> 2.
                                            id: '#12',
                                            title: ['B', '2'],
                                            total: 20,
                                            self: 0,
                                            isLowerBound: true,
                                            children: [
                                              [],
                                              []
                                            ]
                                          }
                                        ]
                                      ]
                                    },
                                    {  // A -> B -> B, 1 -> 2.
                                      id: '#13',
                                      title: ['B', '2'],
                                      total: 20,
                                      self: 0,
                                      isLowerBound: true,
                                      children: [
                                        [],
                                        []
                                      ]
                                    }
                                  ]
                                ]
                              },
                              {  // A -> B -> B, 2.
                                id: '#14',
                                title: ['B', '2'],
                                total: 20,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [],
                                  []
                                ]
                              }
                            ]
                          ]
                        }
                      ],
                      [
                        {  // A -> B, 1.
                          id: '#15',
                          title: ['B', '1'],
                          total: 35,
                          self: 5,
                          isLowerBound: true,
                          children: [
                            [
                              '#10'  // A -> B -> B, 1.
                            ],
                            [
                              {  // A -> B, 1 -> 1.
                                id: '#16',
                                title: ['B', '1'],
                                total: 25,
                                self: 5,
                                isLowerBound: true,
                                children: [
                                  [
                                    '#11'  // A -> B -> B, 1 -> 1.
                                  ],
                                  [
                                    {  // A -> B, 1 -> 1 -> 2.
                                      id: '#17',
                                      title: ['B', '2'],
                                      total: 20,
                                      self: 0,
                                      isLowerBound: true,
                                      children: [
                                        [
                                          '#12'  // A -> B -> B, 1 -> 1 -> 2.
                                        ],
                                        []
                                      ]
                                    }
                                  ]
                                ]
                              },
                              {  // A -> B, 1 -> 2.
                                id: '#18',
                                title: ['B', '2'],
                                total: 30,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [
                                    '#13'  // A -> B -> B, 1 -> 2.
                                  ],
                                  [
                                    {  // A -> B, 1 -> 2 -> 2.
                                      id: '#19',
                                      title: ['B', '2'],
                                      total: 10,
                                      self: 10,
                                      isLowerBound: true,
                                      children: [
                                        [],
                                        []
                                      ]
                                    }
                                  ]
                                ]
                              }
                            ]
                          ]
                        },
                        {  // A -> B, 2.
                          id: '#20',
                          title: ['B', '2'],
                          total: 30,
                          self: 10,
                          isLowerBound: true,
                          children: [
                            [
                              '#14'  // A -> B -> B, 2.
                            ],
                            [
                              {  // A -> B, 2 -> 2.
                                id: '#21',
                                title: ['B', '2'],
                                total: 10,
                                self: 10,
                                isLowerBound: true,
                                children: [
                                  [],
                                  []
                                ]
                              }
                            ]
                          ]
                        }
                      ]
                    ]
                  }
                ],
                [
                  {  // A, 1.
                    id: '#22',
                    title: ['A', '1'],
                    total: 65,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#5',  // A -> A, 1.
                        '#15'  // A -> B, 1.
                      ],
                      [
                        {  // A, 1 -> 2.
                          id: '#23',
                          title: ['A', '2'],
                          total: 60,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [
                              '#6',  // A -> A, 1 -> 2.
                              '#18'  // A -> B, 1 -> 2.
                            ],
                            [
                              {  // A, 1 -> 2 -> 2.
                                id: '#24',
                                title: ['A', '2'],
                                total: 10,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [
                                    '#7',  // A -> A, 1 -> 2 -> 2.
                                    '#19'  // A -> B, 1 -> 2 -> 2.
                                  ],
                                  []
                                ]
                              }
                            ]
                          ]
                        },
                        {  // A, 1 -> 1.
                          id: '#25',
                          title: ['A', '1'],
                          total: 25,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [
                              '#16'  // A -> B, 1 -> 1.
                            ],
                            [
                              {  // A, 1 -> 1 -> 2.
                                id: '#26',
                                title: ['A', '2'],
                                total: 20,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [
                                    '#17'  // A -> B, 1 -> 1 -> 2.
                                  ],
                                  []
                                ]
                              }
                            ]
                          ]
                        }
                      ]
                    ]
                  },
                  {  // A, 2.
                    id: '#27',
                    title: ['A', '2'],
                    total: 60,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#8',  // A -> A, 2.
                        '#20'  // A -> B, 2.
                      ],
                      [
                        {  // A, 2 -> 2.
                          id: '#28',
                          title: ['A', '2'],
                          total: 10,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [
                              '#9',  // A -> A, 2 -> 2.
                              '#21'  // A -> B, 2 -> 2.
                            ],
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ]
              ]
            },
            {  // B, *.
              title: ['B', undefined],
              total: 35,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  {  // B -> B, *.
                    title: ['B', undefined],
                    total: 20,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [],
                      [
                        {  // B -> B, 1.
                          id: '#29',
                          title: ['B', '1'],
                          total: 20,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [],
                            [
                              {  // B -> B, 1 -> 1.
                                id: '#30',
                                title: ['B', '1'],
                                total: 20,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [],
                                  [
                                    {  // B -> B, 1 -> 1 -> 2.
                                      id: '#31',
                                      title: ['B', '2'],
                                      total: 20,
                                      self: 0,
                                      isLowerBound: true,
                                      children: [
                                        [],
                                        []
                                      ]
                                    }
                                  ]
                                ]
                              },
                              {  // B -> B, 1 -> 2.
                                id: '#32',
                                title: ['B', '2'],
                                total: 20,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [],
                                  []
                                ]
                              }
                            ]
                          ]
                        },
                        {  // B -> B, 2.
                          id: '#33',
                          title: ['B', '2'],
                          total: 20,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [],
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ],
                [
                  {  // B, 1.
                    id: '#34',
                    title: ['B', '1'],
                    total: 35,
                    self: 5,
                    isLowerBound: true,
                    children: [
                      [
                        '#29'  // B -> B, 1.
                      ],
                      [
                        {  // B, 1 -> 2.
                          id: '#35',
                          title: ['B', '2'],
                          total: 30,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [
                              '#32'  // B -> B, 1 -> 2.
                            ],
                            [
                              {  // B, 1 -> 2 -> 2.
                                id: '#36',
                                title: ['B', '2'],
                                total: 10,
                                self: 10,
                                isLowerBound: true,
                                children: [
                                  [],
                                  []
                                ]
                              }
                            ]
                          ]
                        },
                        {  // B, 1 -> 1.
                          id: '#37',
                          title: ['B', '1'],
                          total: 25,
                          self: 5,
                          isLowerBound: true,
                          children: [
                            [
                              '#30'  // B -> B, 1 -> 1.
                            ],
                            [
                              {  // B, 1 -> 1 -> 2.
                                id: '#38',
                                title: ['B', '2'],
                                total: 20,
                                self: 0,
                                isLowerBound: true,
                                children: [
                                  [
                                    '#31'  // B -> B, 1 -> 1 -> 2.
                                  ],
                                  []
                                ]
                              }
                            ]
                          ]
                        }
                      ]
                    ]
                  },
                  {  // B, 2.
                    id: '#39',
                    title: ['B', '2'],
                    total: 30,
                    self: 10,
                    isLowerBound: true,
                    children: [
                      [
                        '#33'  // B -> B, 2.
                      ],
                      [
                        {  // B, 2 -> 2.
                          id: '#40',
                          title: ['B', '2'],
                          total: 10,
                          self: 10,
                          isLowerBound: true,
                          children: [
                            [],
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ]
              ]
            }
          ],
          [
            {  // *, 1.
              title: [undefined, '1'],
              total: 65,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  '#22',  // A, 1.
                  '#34'  // B, 1.
                ],
                [
                  {  // *, 1 -> 2.
                    title: [undefined, '2'],
                    total: 60,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#23',  // A, 1 -> 2.
                        '#35'  // B, 1 -> 2.
                      ],
                      [
                        {  // *, 1 -> 2 -> 2.
                          title: [undefined, '2'],
                          total: 10,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [
                              '#24',  // A, 1 -> 2 -> 2.
                              '#36'  // B, 1 -> 2 -> 2.
                            ],
                            []
                          ]
                        }
                      ]
                    ]
                  },
                  {  // *, 1 -> 1.
                    title: [undefined, '1'],
                    total: 25,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#25',  // A, 1 -> 1.
                        '#37'  // B, 1 -> 1.
                      ],
                      [
                        {  // *, 1 -> 1 -> 2.
                          title: [undefined, '2'],
                          total: 20,
                          self: 0,
                          isLowerBound: true,
                          children: [
                            [
                              '#26',  // A, 1 -> 1 -> 2.
                              '#38'  // B, 1 -> 1 -> 2.
                            ],
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ]
              ]
            },
            {  // *, 2.
              title: [undefined, '2'],
              total: 60,
              self: 0,
              isLowerBound: true,
              children: [
                [
                  '#27',  // A, 2.
                  '#39'  // B, 2.
                ],
                [
                  {  // *, 2 -> 2.
                    title: [undefined, '2'],
                    total: 10,
                    self: 0,
                    isLowerBound: true,
                    children: [
                      [
                        '#28',  // A, 2 -> 2.
                        '#40'  // B, 2 -> 2.
                      ],
                      []
                    ]
                  }
                ]
              ]
            }
          ]
        ]
      });

  builderTest('threeDimensions', 3 /* dimensions */,
      [
        { path: [['A', 'B'], ['C', 'D'], ['E', 'F']], value: b(0), kind: SELF },
        { path: [['A', 'B'], ['C', 'D'], ['E']], value: b(1), kind: SELF },
        { path: [['A', 'B'], ['C', 'D'], []], value: b(2), kind: SELF },
        { path: [['A', 'B'], ['C'], ['E', 'F']], value: b(3), kind: SELF },
        { path: [['A', 'B'], ['C'], ['E']], value: b(4), kind: SELF },
        { path: [['A', 'B'], ['C'], []], value: b(5), kind: SELF },
        { path: [['A', 'B'], [], ['E', 'F']], value: b(6), kind: SELF },
        { path: [['A', 'B'], [], ['E']], value: b(7), kind: SELF },
        { path: [['A', 'B'], [], []], value: b(8), kind: SELF },

        { path: [['A'], ['C', 'D'], ['E', 'F']], value: b(9), kind: SELF },
        { path: [['A'], ['C', 'D'], ['E']], value: b(10), kind: SELF },
        { path: [['A'], ['C', 'D'], []], value: b(11), kind: SELF },
        { path: [['A'], ['C'], ['E', 'F']], value: b(12), kind: SELF },
        { path: [['A'], ['C'], ['E']], value: b(13), kind: SELF },
        { path: [['A'], ['C'], []], value: b(14), kind: SELF },
        { path: [['A'], [], ['E', 'F']], value: b(15), kind: SELF },
        { path: [['A'], [], ['E']], value: b(16), kind: SELF },
        { path: [['A'], [], []], value: b(17), kind: SELF },

        { path: [[], ['C', 'D'], ['E', 'F']], value: b(18), kind: SELF },
        { path: [[], ['C', 'D'], ['E']], value: b(19), kind: SELF },
        { path: [[], ['C', 'D'], []], value: b(20), kind: SELF },
        { path: [[], ['C'], ['E', 'F']], value: b(21), kind: SELF },
        { path: [[], ['C'], ['E']], value: b(22), kind: SELF },
        { path: [[], ['C'], []], value: b(23), kind: SELF },
        { path: [[], [], ['E', 'F']], value: b(24), kind: SELF },
        { path: [[], [], ['E']], value: b(25), kind: SELF },
        { path: [[], [], []], value: b(26), kind: SELF }
      ],
      {  // Tree view.
        title: [undefined, undefined, undefined],
        total: b([0, 26]),
        self: b(26),
        isLowerBound: false,
        children: [
          [
            {  // A, *, *.
              title: ['A', undefined, undefined],
              total: b([0, 17]),
              self: b(17),
              isLowerBound: false,
              children: [
                [
                  {  // A -> B, *, *.
                    title: ['B', undefined, undefined],
                    total: b([0, 8]),
                    self: b(8),
                    isLowerBound: false,
                    children: [
                      [],
                      [
                        {  // A -> B, C, *.
                          id: '#0',
                          title: ['B', 'C', undefined],
                          total: b([0, 5]),
                          self: b(5),
                          isLowerBound: false,
                          children: [
                            [],
                            [
                              {  // A -> B, C -> D, *.
                                id: '#1',
                                title: ['B', 'D', undefined],
                                total: b([0, 2]),
                                self: b(2),
                                isLowerBound: false,
                                children: [
                                  [],
                                  [],
                                  [
                                    {  // A -> B, C -> D, E.
                                      id: '#2',
                                      title: ['B', 'D', 'E'],
                                      total: b(0, 1),
                                      self: b(1),
                                      isLowerBound: false,
                                      children: [
                                        [],
                                        [],
                                        [
                                          {  // A -> B, C -> D, E -> F.
                                            id: '#3',
                                            title: ['B', 'D', 'F'],
                                            total: b(0),
                                            self: b(0),
                                            isLowerBound: false,
                                            children: [
                                              [],
                                              [],
                                              []
                                            ]
                                          }
                                        ]
                                      ]
                                    }
                                  ]
                                ]
                              }
                            ],
                            [
                              {  // A -> B, C, E.
                                id: '#4',
                                title: ['B', 'C', 'E'],
                                total: b(0, 1, 3, 4),
                                self: b(4),
                                isLowerBound: false,
                                children: [
                                  [],
                                  [
                                    '#2'  // A -> B, C -> D, E.
                                  ],
                                  [
                                    {  // A -> B, C, E -> F.
                                      id: '#5',
                                      title: ['B', 'C', 'F'],
                                      total: b(0, 3),
                                      self: b(3),
                                      isLowerBound: false,
                                      children: [
                                        [],
                                        [
                                          '#3'  // A -> B, C -> D, E -> F.
                                        ],
                                        []
                                      ]
                                    }
                                  ]
                                ]
                              }
                            ]
                          ]
                        }
                      ],
                      [
                        {  // A -> B, *, E.
                          id: '#6',
                          title: ['B', undefined, 'E'],
                          total: b(0, 1, 3, 4, 6, 7),
                          self: b(7),
                          isLowerBound: false,
                          children: [
                            [],
                            [
                              '#4'  // A -> B, C, E.
                            ],
                            [
                              {  // A -> B, *, E -> F.
                                id: '#7',
                                title: ['B', undefined, 'F'],
                                total: b(0, 3, 6),
                                self: b(6),
                                isLowerBound: false,
                                children: [
                                  [],
                                  [
                                    '#5'  // A -> B, C, E -> F.
                                  ],
                                  []
                                ]
                              }
                            ]
                          ]
                        }
                      ]
                    ]
                  }
                ],
                [
                  {  // A, C, *.
                    id: '#8',
                    title: ['A', 'C', undefined],
                    total: b([0, 5], [9, 14]),
                    self: b(14),
                    isLowerBound: false,
                    children: [
                      [
                        '#0'  // A -> B, C, *.
                      ],
                      [
                        {  // A, C -> D, *.
                          id: '#9',
                          title: ['A', 'D', undefined],
                          total: b([0, 2], [9, 11]),
                          self: b(11),
                          isLowerBound: false,
                          children: [
                            [
                              '#1'  // A -> B, C -> D, *.
                            ],
                            [],
                            [
                              {  // A, C -> D, E.
                                id: '#10',
                                title: ['A', 'D', 'E'],
                                total: b(0, 1, 9, 10),
                                self: b(10),
                                isLowerBound: false,
                                children: [
                                  [
                                    '#2'  // A -> B, C -> D, E.
                                  ],
                                  [],
                                  [
                                    {  // A, C -> D, E -> F.
                                      id: '#11',
                                      title: ['A', 'D', 'F'],
                                      total: b(0, 9),
                                      self: b(9),
                                      isLowerBound: false,
                                      children: [
                                        [
                                          '#3'  // A -> B, C -> D, E -> F.
                                        ],
                                        [],
                                        []
                                      ]
                                    }
                                  ]
                                ]
                              }
                            ]
                          ]
                        }
                      ],
                      [
                        {  // A, C, E.
                          id: '#12',
                          title: ['A', 'C', 'E'],
                          total: b(0, 1, 3, 4, 9, 10, 12, 13),
                          self: b(13),
                          isLowerBound: false,
                          children: [
                            [
                              '#4'  // A -> B, C, E.
                            ],
                            [
                              '#10'  // A, C -> D, E.
                            ],
                            [
                              {  // A, C, E -> F.
                                id: '#13',
                                title: ['A', 'C', 'F'],
                                total: b(0, 3, 9, 12),
                                self: b(12),
                                isLowerBound: false,
                                children: [
                                  [
                                    '#5'  // A -> B, C, E -> F.
                                  ],
                                  [
                                    '#11'  // A, C -> D, E -> F.
                                  ],
                                  []
                                ]
                              }
                            ]
                          ]
                        }
                      ]
                    ]
                  }
                ],
                [
                  {  // A, *, E.
                    id: '#14',
                    title: ['A', undefined, 'E'],
                    total: b(0, 1, 3, 4, 6, 7, 9, 10, 12, 13, 15, 16),
                    self: b(16),
                    isLowerBound: false,
                    children: [
                      [
                        '#6'  // A -> B, *, E.
                      ],
                      [
                        '#12'  // A, C, E.
                      ],
                      [
                        {  // A, *, E -> F.
                          id: '#15',
                          title: ['A', undefined, 'F'],
                          total: b(0, 3, 6, 9, 12, 15),
                          self: b(15),
                          isLowerBound: false,
                          children: [
                            [
                              '#7'  // A -> B, *, E -> F.
                            ],
                            [
                              '#13'  // A, C, E -> F.
                            ],
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ]
              ]
            }
          ],
          [
            {  // *, C, *.
              title: [undefined, 'C', undefined],
              total: b([0, 5], [9, 14], [18, 23]),
              self: b(23),
              isLowerBound: false,
              children: [
                [
                  '#8'  // A, C, *.
                ],
                [
                  {  // *, C -> D, *.
                    title: [undefined, 'D', undefined],
                    total: b([0, 2], [9, 11], [18, 20]),
                    self: b(20),
                    isLowerBound: false,
                    children: [
                      [
                        '#9'  // A, C -> D, *.
                      ],
                      [],
                      [
                        {  // *, C -> D, E.
                          id: '#16',
                          title: [undefined, 'D', 'E'],
                          total: b(0, 1, 9, 10, 18, 19),
                          self: b(19),
                          isLowerBound: false,
                          children: [
                            [
                              '#10'  // A, C -> D, E.
                            ],
                            [],
                            [
                              {  // *, C -> D, E -> F.
                                id: '#17',
                                title: [undefined, 'D', 'F'],
                                total: b(0, 9, 18),
                                self: b(18),
                                isLowerBound: false,
                                children: [
                                  [
                                    '#11'  // A, C -> D, E -> F.
                                  ],
                                  [],
                                  []
                                ]
                              }
                            ]
                          ]
                        }
                      ]
                    ]
                  }
                ],
                [
                  {  // *, C, E.
                    id: '#18',
                    title: [undefined, 'C', 'E'],
                    total: b(0, 1, 3, 4, 9, 10, 12, 13, 18, 19, 21, 22),
                    self: b(22),
                    isLowerBound: false,
                    children: [
                      [
                        '#12'  // A, C, E.
                      ],
                      [
                        '#16'  // *, C -> D, E.
                      ],
                      [
                        {  // *, C, E -> F.
                          id: '#19',
                          title: [undefined, 'C', 'F'],
                          total: b(0, 3, 9, 12, 18, 21),
                          self: b(21),
                          isLowerBound: false,
                          children: [
                            [
                              '#13'  // A, C, E -> F.
                            ],
                            [
                              '#17'  // *, C -> D, E -> F.
                            ],
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ]
              ]
            }
          ],
          [
            {  // *, *, E.
              title: [undefined, undefined, 'E'],
              total: b(0, 1, 3, 4, 6, 7, 9, 10, 12, 13, 15, 16, 18, 19, 21, 22,
                  24, 25),
              self: b(25),
              isLowerBound: false,
              children: [
                [
                  '#14'  // A, *, E.
                ],
                [
                  '#18'  // *, C, E.
                ],
                [
                  {  // *, *, E -> F.
                    title: [undefined, undefined, 'F'],
                    total: b(0, 3, 6, 9, 12, 15, 18, 21, 24),
                    self: b(24),
                    isLowerBound: false,
                    children: [
                      [
                        '#15'  // A, *, E -> F.
                      ],
                      [
                        '#19'  // *, C, E -> F.
                      ],
                      []
                    ]
                  }
                ]
              ]
            }
          ]
        ]
      },
      {  // Heavy view.
        title: [undefined, undefined, undefined],
        total: b([0, 26]),
        self: b(26),
        isLowerBound: false,
        children: [
          [
            {  // A, *, *.
              title: ['A', undefined, undefined],
              total: b([0, 17]),
              self: b(17),
              isLowerBound: true,
              children: [
                [
                  {  // A -> B, *, *.
                    title: ['B', undefined, undefined],
                    total: b([0, 8]),
                    self: b(8),
                    isLowerBound: true,
                    children: [
                      [],
                      [
                        {  // A -> B, C, *.
                          id: '#0',
                          title: ['B', 'C', undefined],
                          total: b([0, 5]),
                          self: b(5),
                          isLowerBound: true,
                          children: [
                            [],
                            [
                              {  // A -> B, C -> D, *.
                                id: '#1',
                                title: ['B', 'D', undefined],
                                total: b([0, 2]),
                                self: b(2),
                                isLowerBound: true,
                                children: [
                                  [],
                                  [],
                                  [
                                    {  // A -> B, C -> D, E.
                                      id: '#2',
                                      title: ['B', 'D', 'E'],
                                      total: b(0, 1),
                                      self: b(1),
                                      isLowerBound: true,
                                      children: [
                                        [],
                                        [],
                                        [
                                          {  // A -> B, C -> D, E -> F.
                                            id: '#3',
                                            title: ['B', 'D', 'F'],
                                            total: b(0),
                                            self: b(0),
                                            isLowerBound: true,
                                            children: [
                                              [],
                                              [],
                                              []
                                            ]
                                          }
                                        ]
                                      ]
                                    },
                                    {  // A -> B, C -> D, F.
                                      id: '#4',
                                      title: ['B', 'D', 'F'],
                                      total: b(0),
                                      self: b(0),
                                      isLowerBound: true,
                                      children: [
                                        [],
                                        [],
                                        []
                                      ]
                                    }
                                  ]
                                ]
                              }
                            ],
                            [
                              {  // A -> B, C, E.
                                id: '#5',
                                title: ['B', 'C', 'E'],
                                total: b(0, 1, 3, 4),
                                self: b(4),
                                isLowerBound: true,
                                children: [
                                  [],
                                  [
                                    '#2'  // A -> B, C -> D, E.
                                  ],
                                  [
                                    {  // A -> B, C, E -> F.
                                      id: '#6',
                                      title: ['B', 'C', 'F'],
                                      total: b(0, 3),
                                      self: b(3),
                                      isLowerBound: true,
                                      children: [
                                        [],
                                        [
                                          '#3'  // A -> B, C -> D, E -> F.
                                        ],
                                        []
                                      ]
                                    }
                                  ]
                                ]
                              },
                              {  // A -> B, C, F.
                                id: '#7',
                                title: ['B', 'C', 'F'],
                                total: b(0, 3),
                                self: b(3),
                                isLowerBound: true,
                                children: [
                                  [],
                                  [
                                    '#4'  // A -> B, C -> D, F.
                                  ],
                                  []
                                ]
                              }
                            ]
                          ]
                        },
                        {  // A -> B, D, *.
                          id: '#8',
                          title: ['B', 'D', undefined],
                          total: b([0, 2]),
                          self: b(2),
                          isLowerBound: true,
                          children: [
                            [],
                            [],
                            [
                              {  // A -> B, D, E.
                                id: '#9',
                                title: ['B', 'D', 'E'],
                                total: b(0, 1),
                                self: b(1),
                                isLowerBound: true,
                                children: [
                                  [],
                                  [],
                                  [
                                    {  // A -> B, D, E -> F.
                                      id: '#10',
                                      title: ['B', 'D', 'F'],
                                      total: b(0),
                                      self: b(0),
                                      isLowerBound: true,
                                      children: [
                                        [],
                                        [],
                                        []
                                      ]
                                    }
                                  ]
                                ]
                              },
                              {  // A -> B, D, F.
                                id: '#11',
                                title: ['B', 'D', 'F'],
                                total: b(0),
                                self: b(0),
                                isLowerBound: true,
                                children: [
                                  [],
                                  [],
                                  []
                                ]
                              }
                            ]
                          ]
                        }
                      ],
                      [
                        {  // A -> B, *, E.
                          id: '#12',
                          title: ['B', undefined, 'E'],
                          total: b(0, 1, 3, 4, 6, 7),
                          self: b(7),
                          isLowerBound: true,
                          children: [
                            [],
                            [
                              '#5',  // A -> B, C, E.
                              '#9'  // A -> B, D, E.
                            ],
                            [
                              {  // A -> B, *, E -> F.
                                id: '#13',
                                title: ['B', undefined, 'F'],
                                total: b(0, 3, 6),
                                self: b(6),
                                isLowerBound: true,
                                children: [
                                  [],
                                  [
                                    '#6',  // A -> B, C, E -> F.
                                    '#10'  // A -> B, D, E -> F.
                                  ],
                                  []
                                ]
                              }
                            ]
                          ]
                        },
                        {  // A -> B, *, F.
                          id: '#14',
                          title: ['B', undefined, 'F'],
                          total: b(0, 3, 6),
                          self: b(6),
                          isLowerBound: true,
                          children: [
                            [],
                            [
                              '#7',  // A -> B, C, F.
                              '#11'  // A -> B, D, F.
                            ],
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ],
                [
                  {  // A, C, *.
                    id: '#15',
                    title: ['A', 'C', undefined],
                    total: b([0, 5], [9, 14]),
                    self: b(14),
                    isLowerBound: true,
                    children: [
                      [
                        '#0'  // A -> B, C, *.
                      ],
                      [
                        {  // A, C -> D, *.
                          id: '#16',
                          title: ['A', 'D', undefined],
                          total: b([0, 2], [9, 11]),
                          self: b(11),
                          isLowerBound: true,
                          children: [
                            [
                              '#1'  // A -> B, C -> D, *.
                            ],
                            [],
                            [
                              {  // A, C -> D, E.
                                id: '#17',
                                title: ['A', 'D', 'E'],
                                total: b(0, 1, 9, 10),
                                self: b(10),
                                isLowerBound: true,
                                children: [
                                  [
                                    '#2'  // A -> B, C -> D, E.
                                  ],
                                  [],
                                  [
                                    {  // A, C -> D, E -> F.
                                      id: '#18',
                                      title: ['A', 'D', 'F'],
                                      total: b(0, 9),
                                      self: b(9),
                                      isLowerBound: true,
                                      children: [
                                        [
                                          '#3'  // A -> B, C -> D, E -> F.
                                        ],
                                        [],
                                        []
                                      ]
                                    }
                                  ]
                                ]
                              },
                              {  // A, C -> D, F.
                                id: '#19',
                                title: ['A', 'D', 'F'],
                                total: b(0, 9),
                                self: b(9),
                                isLowerBound: true,
                                children: [
                                  [
                                    '#4'  // A -> B, C -> D, F.
                                  ],
                                  [],
                                  []
                                ]
                              }
                            ]
                          ]
                        }
                      ],
                      [
                        {  // A, C, E.
                          id: '#20',
                          title: ['A', 'C', 'E'],
                          total: b(0, 1, 3, 4, 9, 10, 12, 13),
                          self: b(13),
                          isLowerBound: true,
                          children: [
                            [
                              '#5'  // A -> B, C, E.
                            ],
                            [
                              '#17'  // A, C -> D, E.
                            ],
                            [
                              {  // A, C, E -> F.
                                id: '#21',
                                title: ['A', 'C', 'F'],
                                total: b(0, 3, 9, 12),
                                self: b(12),
                                isLowerBound: true,
                                children: [
                                  [
                                    '#6'  // A -> B, C, E -> F.
                                  ],
                                  [
                                    '#18'  // A, C -> D, E -> F.
                                  ],
                                  []
                                ]
                              }
                            ]
                          ]
                        },
                        {  // A, C, F.
                          id: '#22',
                          title: ['A', 'C', 'F'],
                          total: b(0, 3, 9, 12),
                          self: b(12),
                          isLowerBound: true,
                          children: [
                            [
                              '#7'  // A -> B, C, F.
                            ],
                            [
                              '#19'  // A, C -> D, F.
                            ],
                            []
                          ]
                        }
                      ]
                    ]
                  },
                  {  // A, D, *.
                    id: '#23',
                    title: ['A', 'D', undefined],
                    total: b([0, 2], [9, 11]),
                    self: b(11),
                    isLowerBound: true,
                    children: [
                      [
                        '#8'  // A -> B, D, *.
                      ],
                      [],
                      [
                        {  // A, D, E.
                          id: '#24',
                          title: ['A', 'D', 'E'],
                          total: b(0, 1, 9, 10),
                          self: b(10),
                          isLowerBound: true,
                          children: [
                            [
                              '#9'  // A -> B, D, E.
                            ],
                            [],
                            [
                              {  // A, D, E -> F.
                                id: '#25',
                                title: ['A', 'D', 'F'],
                                total: b(0, 9),
                                self: b(9),
                                isLowerBound: true,
                                children: [
                                  [
                                    '#10'  // A -> B, D, E -> F.
                                  ],
                                  [],
                                  []
                                ]
                              }
                            ]
                          ]
                        },
                        {  // A, D, F.
                          id: '#26',
                          title: ['A', 'D', 'F'],
                          total: b(0, 9),
                          self: b(9),
                          isLowerBound: true,
                          children: [
                            [
                              '#11'  // A -> B, D, F.
                            ],
                            [],
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ],
                [
                  {  // A, *, E.
                    id: '#27',
                    title: ['A', undefined, 'E'],
                    total: b(0, 1, 3, 4, 6, 7, 9, 10, 12, 13, 15, 16),
                    self: b(16),
                    isLowerBound: true,
                    children: [
                      [
                        '#12'  // A -> B, *, E.
                      ],
                      [
                        '#20',  // A, C, E.
                        '#24'  // A, D, E.
                      ],
                      [
                        {  // A, *, E -> F.
                          id: '#28',
                          title: ['A', undefined, 'F'],
                          total: b(0, 3, 6, 9, 12, 15),
                          self: b(15),
                          isLowerBound: true,
                          children: [
                            [
                              '#13'  // A -> B, *, E -> F.
                            ],
                            [
                              '#21',  // A, C, E -> F.
                              '#25'  // A, D, E -> F.
                            ],
                            []
                          ]
                        }
                      ]
                    ]
                  },
                  {  // A, *, F.
                    id: '#29',
                    title: ['A', undefined, 'F'],
                    total: b(0, 3, 6, 9, 12, 15),
                    self: b(15),
                    isLowerBound: true,
                    children: [
                      [
                        '#14'  // A -> B, *, F.
                      ],
                      [
                        '#22',  // A, C, F.
                        '#26'  // A, D, F.
                      ],
                      []
                    ]
                  }
                ]
              ]
            },
            {  // B, *, *.
              title: ['B', undefined, undefined],
              total: b([0, 8]),
              self: b(8),
              isLowerBound: true,
              children: [
                [],
                [
                  {  // B, C, *.
                    id: '#30',
                    title: ['B', 'C', undefined],
                    total: b([0, 5]),
                    self: b(5),
                    isLowerBound: true,
                    children: [
                      [],
                      [
                        {  // B, C -> D, *.
                          id: '#31',
                          title: ['B', 'D', undefined],
                          total: b([0, 2]),
                          self: b(2),
                          isLowerBound: true,
                          children: [
                            [],
                            [],
                            [
                              {  // B, C -> D, E.
                                id: '#32',
                                title: ['B', 'D', 'E'],
                                total: b(0, 1),
                                self: b(1),
                                isLowerBound: true,
                                children: [
                                  [],
                                  [],
                                  [
                                    {  // B, C -> D, E -> F.
                                      id: '#33',
                                      title: ['B', 'D', 'F'],
                                      total: b(0),
                                      self: b(0),
                                      isLowerBound: true,
                                      children: [
                                        [],
                                        [],
                                        []
                                      ]
                                    }
                                  ]
                                ]
                              },
                              {  // B, C -> D, F.
                                id: '#34',
                                title: ['B', 'D', 'F'],
                                total: b(0),
                                self: b(0),
                                isLowerBound: true,
                                children: [
                                  [],
                                  [],
                                  []
                                ]
                              }
                            ]
                          ]
                        }
                      ],
                      [
                        {  // B, C, E.
                          id: '#35',
                          title: ['B', 'C', 'E'],
                          total: b(0, 1, 3, 4),
                          self: b(4),
                          isLowerBound: true,
                          children: [
                            [],
                            [
                              '#32'  // B, C -> D, E.
                            ],
                            [
                              {  // B, C, E -> F.
                                id: '#36',
                                title: ['B', 'C', 'F'],
                                total: b(0, 3),
                                self: b(3),
                                isLowerBound: true,
                                children: [
                                  [],
                                  [
                                    '#33'  // B, C -> D, E -> F.
                                  ],
                                  []
                                ]
                              }
                            ]
                          ]
                        },
                        {  // B, C, F.
                          id: '#37',
                          title: ['B', 'C', 'F'],
                          total: b(0, 3),
                          self: b(3),
                          isLowerBound: true,
                          children: [
                            [],
                            [
                              '#34'  // B, C -> D, F.
                            ],
                            []
                          ]
                        }
                      ]
                    ]
                  },
                  {  // B, D, *.
                    id: '#38',
                    title: ['B', 'D', undefined],
                    total: b([0, 2]),
                    self: b(2),
                    isLowerBound: true,
                    children: [
                      [],
                      [],
                      [
                        {  // B, D, E.
                          id: '#39',
                          title: ['B', 'D', 'E'],
                          total: b(0, 1),
                          self: b(1),
                          isLowerBound: true,
                          children: [
                            [],
                            [],
                            [
                              {  // B, D, E -> F.
                                id: '#40',
                                title: ['B', 'D', 'F'],
                                total: b(0),
                                self: b(0),
                                isLowerBound: true,
                                children: [
                                  [],
                                  [],
                                  []
                                ]
                              }
                            ]
                          ]
                        },
                        {  // B, D, F.
                          id: '#41',
                          title: ['B', 'D', 'F'],
                          total: b(0),
                          self: b(0),
                          isLowerBound: true,
                          children: [
                            [],
                            [],
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ],
                [
                  {  // B, *, E.
                    id: '#42',
                    title: ['B', undefined, 'E'],
                    total: b(0, 1, 3, 4, 6, 7),
                    self: b(7),
                    isLowerBound: true,
                    children: [
                      [],
                      [
                        '#35',  // B, C, E.
                        '#39'  // B, D, E.
                      ],
                      [
                        {  // B, *, E -> F.
                          id: '#43',
                          title: ['B', undefined, 'F'],
                          total: b(0, 3, 6),
                          self: b(6),
                          isLowerBound: true,
                          children: [
                            [],
                            [
                              '#36',  // B, C, E -> F.
                              '#40'  // B, D, E -> F.
                            ],
                            []
                          ]
                        }
                      ]
                    ]
                  },
                  {  // B, *, F.
                    id: '#44',
                    title: ['B', undefined, 'F'],
                    total: b(0, 3, 6),
                    self: b(6),
                    isLowerBound: true,
                    children: [
                      [],
                      [
                        '#37',  // B, C, F.
                        '#41'  // B, D, F.
                      ],
                      []
                    ]
                  }
                ]
              ]
            }
          ],
          [
            {  // *, C, *.
              title: [undefined, 'C', undefined],
              total: b([0, 5], [9, 14], [18, 23]),
              self: b(23),
              isLowerBound: true,
              children: [
                [
                  '#15',  // A, C, *.
                  '#30'  // B, C, *.
                ],
                [
                  {  // *, C -> D, *.
                    title: [undefined, 'D', undefined],
                    total: b([0, 2], [9, 11], [18, 20]),
                    self: b(20),
                    isLowerBound: true,
                    children: [
                      [
                        '#16',  // A, C -> D, *.
                        '#31'  // B, C -> D, *.
                      ],
                      [],
                      [
                        {  // *, C -> D, E.
                          id: '#45',
                          title: [undefined, 'D', 'E'],
                          total: b(0, 1, 9, 10, 18, 19),
                          self: b(19),
                          isLowerBound: true,
                          children: [
                            [
                              '#17',  // A, C -> D, E.
                              '#32'  // B, C -> D, E.
                            ],
                            [],
                            [
                              {  // *, C -> D, E -> F.
                                id: '#46',
                                title: [undefined, 'D', 'F'],
                                total: b(0, 9, 18),
                                self: b(18),
                                isLowerBound: true,
                                children: [
                                  [
                                    '#18',  // A, C -> D, E -> F.
                                    '#33'  // B, C -> D, E -> F.
                                  ],
                                  [],
                                  []
                                ]
                              }
                            ]
                          ]
                        },
                        {  // *, C -> D, F.
                          id: '#47',
                          title: [undefined, 'D', 'F'],
                          total: b(0, 9, 18),
                          self: b(18),
                          isLowerBound: true,
                          children: [
                            [
                              '#19',  // A, C -> D, F.
                              '#34'  // B, C -> D, F.
                            ],
                            [],
                            []
                          ]
                        }
                      ]
                    ]
                  }
                ],
                [
                  {  // *, C, E.
                    id: '#48',
                    title: [undefined, 'C', 'E'],
                    total: b(0, 1, 3, 4, 9, 10, 12, 13, 18, 19, 21, 22),
                    self: b(22),
                    isLowerBound: true,
                    children: [
                      [
                        '#20',  // A, C, E.
                        '#35'  // B, C, E.
                      ],
                      [
                        '#45'  // *, C -> D, E.
                      ],
                      [
                        {  // *, C, E -> F.
                          id: '#49',
                          title: [undefined, 'C', 'F'],
                          total: b(0, 3, 9, 12, 18, 21),
                          self: b(21),
                          isLowerBound: true,
                          children: [
                            [
                              '#21',  // A, C, E -> F.
                              '#36'  // B, C, E -> F.
                            ],
                            [
                              '#46'  // *, C -> D, E -> F.
                            ],
                            []
                          ]
                        }
                      ]
                    ]
                  },
                  {  // *, C, F.
                    id: '#50',
                    title: [undefined, 'C', 'F'],
                    total: b(0, 3, 9, 12, 18, 21),
                    self: b(21),
                    isLowerBound: true,
                    children: [
                      [
                        '#22',  // A, C, F.
                        '#37'  // B, C, F.
                      ],
                      [
                        '#47'  // *, C -> D, F.
                      ],
                      []
                    ]
                  }
                ]
              ]
            },
            {  // *, D, *.
              title: [undefined, 'D', undefined],
              total: b([0, 2], [9, 11], [18, 20]),
              self: b(20),
              isLowerBound: true,
              children: [
                [
                  '#23',  // A, D, *.
                  '#38'  // B, D, *.
                ],
                [],
                [
                  {  // *, D, E.
                    id: '#51',
                    title: [undefined, 'D', 'E'],
                    total: b(0, 1, 9, 10, 18, 19),
                    self: b(19),
                    isLowerBound: true,
                    children: [
                      [
                        '#24',  // A, D, E.
                        '#39'  // B, D, E.
                      ],
                      [],
                      [
                        {  // *, D, E -> F.
                          id: '#52',
                          title: [undefined, 'D', 'F'],
                          total: b(0, 9, 18),
                          self: b(18),
                          isLowerBound: true,
                          children: [
                            [
                              '#25',  // A, D, E -> F.
                              '#40'  // B, D, E -> F.
                            ],
                            [],
                            []
                          ]
                        }
                      ]
                    ]
                  },
                  {  // *, D, F.
                    id: '#53',
                    title: [undefined, 'D', 'F'],
                    total: b(0, 9, 18),
                    self: b(18),
                    isLowerBound: true,
                    children: [
                      [
                        '#26',  // A, D, F.
                        '#41'  // B, D, F.
                      ],
                      [],
                      []
                    ]
                  }
                ]
              ]
            }
          ],
          [
            {  // *, *, E.
              title: [undefined, undefined, 'E'],
              total: b(0, 1, 3, 4, 6, 7, 9, 10, 12, 13, 15, 16, 18, 19, 21, 22,
                  24, 25),
              self: b(25),
              isLowerBound: true,
              children: [
                [
                  '#27',  // A, *, E.
                  '#42'  // B, *, E.
                ],
                [
                  '#48',  // *, C, E.
                  '#51'  // *, D, E.
                ],
                [
                  {  // *, *, E -> F.
                    title: [undefined, undefined, 'F'],
                    total: b(0, 3, 6, 9, 12, 15, 18, 21, 24),
                    self: b(24),
                    isLowerBound: true,
                    children: [
                      [
                        '#28',  // A, *, E -> F.
                        '#43'  // B, *, E -> F.
                      ],
                      [
                        '#49',  // *, C, E -> F.
                        '#52'  // *, D, E -> F.
                      ],
                      []
                    ]
                  }
                ]
              ]
            },
            {  // *, *, F.
              title: [undefined, undefined, 'F'],
              total: b(0, 3, 6, 9, 12, 15, 18, 21, 24),
              self: b(24),
              isLowerBound: true,
              children: [
                [
                  '#29',  // A, *, F.
                  '#44'  // B, *, F.
                ],
                [
                  '#50',  // *, C, F.
                  '#53'  // *, D, F.
                ],
                []
              ]
            }
          ]
        ]
      });

  test('recursionDepthTracker', function() {
    var tracker = new RecursionDepthTracker(5 /* maxDepth */);

    assert.strictEqual(tracker.recursionDepth, 0);  // empty stack.
    tracker.push('A');
    assert.strictEqual(tracker.recursionDepth, 0);  // A.
    tracker.push('B');
    assert.strictEqual(tracker.recursionDepth, 0);  // A -> B.
    tracker.push('C');
    assert.strictEqual(tracker.recursionDepth, 0);  // A -> B -> C.
    tracker.push('D');
    assert.strictEqual(tracker.recursionDepth, 0);  // A -> B -> C -> D.
    tracker.pop();
    assert.strictEqual(tracker.recursionDepth, 0);  // A -> B -> C.
    tracker.push('A');
    assert.strictEqual(tracker.recursionDepth, 1);  // A -> B -> C -> A.
    tracker.push('B');
    assert.strictEqual(tracker.recursionDepth, 2);  // A -> B -> C -> A -> B.
    tracker.pop();
    assert.strictEqual(tracker.recursionDepth, 1);  // A -> B -> C -> A.
    tracker.pop();
    assert.strictEqual(tracker.recursionDepth, 0);  // A -> B -> C.
    tracker.push('B');
    assert.strictEqual(tracker.recursionDepth, 1);  // A -> B -> C -> B.
    tracker.pop();
    assert.strictEqual(tracker.recursionDepth, 0);  // A -> B -> C.
    tracker.pop();
    assert.strictEqual(tracker.recursionDepth, 0);  // A -> B.
    tracker.pop();
    assert.strictEqual(tracker.recursionDepth, 0);  // A.
    tracker.push('A');
    assert.strictEqual(tracker.recursionDepth, 1);  // A -> A.
    tracker.push('A');
    assert.strictEqual(tracker.recursionDepth, 2);  // A -> A -> A.
    tracker.push('A');
    assert.strictEqual(tracker.recursionDepth, 3);  // A -> A -> A -> A.
    tracker.pop();
    assert.strictEqual(tracker.recursionDepth, 2);  // A -> A -> A.
    tracker.push('B');
    assert.strictEqual(tracker.recursionDepth, 0);  // A -> A -> A -> B.
    tracker.push('A');
    assert.strictEqual(tracker.recursionDepth, 1);  // A -> A -> A -> B -> A.
    tracker.pop();
    assert.strictEqual(tracker.recursionDepth, 0);  // A -> A -> A -> B.
    tracker.pop();
    assert.strictEqual(tracker.recursionDepth, 2);  // A -> A -> A.
    tracker.pop();
    assert.strictEqual(tracker.recursionDepth, 1);  // A -> A.
    tracker.pop();
    assert.strictEqual(tracker.recursionDepth, 0);  // A.
    tracker.pop();
    assert.strictEqual(tracker.recursionDepth, 0);  // empty stack.
    tracker.push('A');
    assert.strictEqual(tracker.recursionDepth, 0);  // A.
    tracker.push('B');
    assert.strictEqual(tracker.recursionDepth, 0);  // A -> B.
    tracker.push('A');
    assert.strictEqual(tracker.recursionDepth, 1);  // A -> B -> A.
    tracker.pop();
    assert.strictEqual(tracker.recursionDepth, 0);  // A -> B.
    tracker.push('C');
    assert.strictEqual(tracker.recursionDepth, 0);  // A -> B -> C.
    tracker.push('A');
    assert.strictEqual(tracker.recursionDepth, 1);  // A -> B -> C -> A.
    tracker.pop();
    assert.strictEqual(tracker.recursionDepth, 0);  // A -> B -> C.
    tracker.pop();
    assert.strictEqual(tracker.recursionDepth, 0);  // A -> B.
    tracker.pop();
    assert.strictEqual(tracker.recursionDepth, 0);  // A.
    tracker.pop();
    assert.strictEqual(tracker.recursionDepth, 0);  // empty stack.

    assert.throws(function() {
      // Try popping from an empty tracker.
      tracker.pop();
    });

    tracker.push('F');
    tracker.push('U');
    tracker.push('L');
    tracker.push('L');
    tracker.push('!');
    assert.throws(function() {
      // Try pushing to a full tracker.
      tracker.push(':-(');
    });
  });

  test('zFunction', function() {
    // Empty list/string (suffix).
    assert.deepEqual(zFunction([], 0), []);
    assert.deepEqual(zFunction(['A'], 1), []);
    assert.deepEqual(zFunction(['A', 'B', 'C'], 3), []);
    assert.deepEqual(zFunction('', 0), []);
    assert.deepEqual(zFunction('A', 1), []);
    assert.deepEqual(zFunction('ABC', 3), []);

    // Singleton list/string.
    checkZFunction([1], [0]);
    checkZFunction('T', [0]);

    // No duplicate elements.
    checkZFunction([1, 2, 3, 4, 5], [0, 0, 0, 0, 0]);
    checkZFunction('ABCDEF', [0, 0, 0, 0, 0, 0]);

    // No substring is a suffix.
    checkZFunction([1, 2, 3, 2], [0, 0, 0, 0]);
    checkZFunction('ABBB', [0, 0, 0, 0]);

    // Pure repetition.
    checkZFunction([1, 1, 1, 1, 1], [0, 4, 3, 2, 1]);
    checkZFunction('AAAAA', [0, 4, 3, 2, 1]);

    // Interleaved repetition.
    checkZFunction([1, 2, 1, 3, 1, 2, 1], [0, 0, 1, 0, 3, 0, 1]);
    checkZFunction('AAABAAB', [0, 2, 1, 0, 2, 1, 0]);

    // Complex patterns.
    checkZFunction([7, 9, 7, 9, 7, 9, 7, 9], [0, 0, 6, 0, 4, 0, 2, 0]);
    checkZFunction('CCGTCCCGTACC', [0, 1, 0, 0, 2, 4, 1, 0, 0, 0, 2, 1]);
  });
});
</script>
