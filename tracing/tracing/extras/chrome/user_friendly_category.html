<!DOCTYPE html>
<!--
Copyright (c) 2015 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<link rel="import" href="/tracing/base/event.html">
<link rel="import" href="/tracing/base/iteration_helpers.html">

<script>
'use strict';

tr.exportTo('tr.e.chrome', function() {
  var DEFAULT_USER_FRIENDLY_CATEGORY = 'other';

  var TITLES_FOR_USER_FRIENDLY_CATEGORY = {
    composite: [
      'ThreadProxy::SetNeedsUpdateLayers',
      'LayerTreeHost::UpdateLayers::CalcDrawProps',
      'UpdateLayerTree'
    ],

    gc: [
      'minorGC',
      'majorGC',
      'MajorGC',
      'MinorGC',
      'V8.GCScavenger',
      'V8.GCIncrementalMarking',
      'V8.GCIdleNotification',
      'V8.GCContext',
      'V8.GCCompactor',
      'V8GCController::traceDOMWrappers'
    ],

    imageDecode: [
      'Decode Image',
      'ImageFrameGenerator::decode'
    ],

    input: [
      'HitTest',
      'ScrollableArea::scrollPositionChanged',
      'EventHandler::handleMouseMoveEvent'
    ],

    layout: [
      'FrameView::invalidateTree',
      'FrameView::layout',
      'FrameView::performLayout',
      'FrameView::performPostLayoutTasks',
      'FrameView::performPreLayoutTasks',
      'Layer::updateLayerPositionsAfterLayout',
      'LayoutView::hitTest',
      'ResourceLoadPriorityOptimizer::updateAllImageResourcePriorities',
      'WebViewImpl::layout'
    ],

    parseHTML: [
      'HTMLDocumentParser::didReceiveParsedChunkFromBackgroundParser',
      'HTMLDocumentParser::processParsedChunkFromBackgroundParser'
    ],

    raster: [
      'Picture::Raster',
      'RasterTask',
      'SkCanvas::drawTextBlob()',
      'SkCanvas::drawImageRect()',
      'SkCanvas::drawPicture()'
    ],

    record: [
      'DeprecatedPaintLayerCompositor::updateIfNeededRecursive',
      'Picture::Record',
      'PictureLayer::Update',
      'RenderLayer::updateLayerPositionsAfterLayout'
    ],

    script: [
      'Script',
      'V8.Execute',
      'v8.run',
      'v8.callModuleMethod',
      'v8.callFunction'
    ],

    style: [
      'CSSParserImpl::parseStyleSheet.parse',
      'CSSParserImpl::parseStyleSheet.tokenize',
      'Document::updateStyle',
      'RuleSet::addRulesFromSheet',
      'StyleElement::processStyleSheet',
      'StyleSheetContents::parseAuthorStyleSheet'
    ],

    script_parse_and_compile: [
      'V8.RecompileSynchronous',
      'V8.RecompileConcurrent',
      'V8.PreParseMicroSeconds',
      'v8.parseOnBackground',
      'V8.ParseMicroSeconds',
      'V8.ParseLazyMicroSeconds',
      'V8.CompileScriptMicroSeconds',
      'V8.CompileMicroSeconds',
      'V8.CompileFullCode',
      'V8.CompileEvalMicroSeconds',
      'v8.compile'
    ]
  };

  var USER_FRIENDLY_CATEGORY_FOR_TITLE = {};

  for (var category in TITLES_FOR_USER_FRIENDLY_CATEGORY) {
    TITLES_FOR_USER_FRIENDLY_CATEGORY[category].forEach(function(title) {
      USER_FRIENDLY_CATEGORY_FOR_TITLE[title] = category;
    });
  }

  var USER_FRIENDLY_CATEGORY_FOR_EVENT_CATEGORY = {
    netlog: 'net',
    overhead: 'overhead',
    startup: 'startup'
  };

  function UserFriendlyCategory() {
  }

  UserFriendlyCategory.fromEvent = function(event) {
    var userFriendlyCategory = USER_FRIENDLY_CATEGORY_FOR_TITLE[event.title];
    if (userFriendlyCategory)
      return userFriendlyCategory;

    var eventCategoryParts = tr.b.getCategoryParts(event.category);
    for (var i = 0; i < eventCategoryParts.length; ++i) {
      var eventCategory = eventCategoryParts[i];
      userFriendlyCategory = USER_FRIENDLY_CATEGORY_FOR_EVENT_CATEGORY[
          eventCategory];
      if (userFriendlyCategory)
        return userFriendlyCategory;
    }

    return DEFAULT_USER_FRIENDLY_CATEGORY;
  };

  return {
    UserFriendlyCategory: UserFriendlyCategory
  };
});
</script>
