<!DOCTYPE html>
<!--
Copyright (c) 2013 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->
<link rel="import" href="/base.html">
<script>
'use strict';

/**
 * @fileoverview Base class for trace data importers.
 */
tv.exportTo('tracing.importer', function() {
  function Importer() { }

  Importer.prototype = {
    __proto__: Object.prototype,

    /**
     * Called by the Model to check whether the importer type stores the actual
     * trace data or just holds it as container for further extraction.
     */
    isTraceDataContainer: function() {
      return false;
    },

    /**
     * Called by the Model to extract one or more subtraces from the event data.
     */
    extractSubtraces: function() {
      return [];
    },

    /**
     * Called to import events into the Model.
     */
    importEvents: function() {
    },

    /**
     * Called to import sample data into the Model.
     */
    importSampleData: function() {
    },

    /**
     * Called by the Model after all other importers have imported their
     * events.
     */
    finalizeImport: function() {
    },

    /**
     * Called by the Model to join references between objects, after final
     * model bounds have been computed.
     */
    joinRefs: function() {
    }
  };

  Importer.importers_ = [];

  Importer.register = function(importerConstructor,
                               opt_options) {
    if (Importer.indexOfImporter_(importerConstructor) !== undefined)
      throw new Error('Handler already registered for ' + importerConstructor);

    var options = opt_options || {};
    Importer.importers_.push({
      constructor: importerConstructor,
      options: options
    });
  };

  Importer.indexOfImporter_ = function(importerConstructor) {
    for (var i = 0; i < Importer.importers_.length; i++)
      if (Importer.importers_[i].constructor == importerConstructor)
        return i;
    return undefined;
  };

  Importer.unregister = function(importerConstructor) {
    var foundIndex = Importer.indexOfImporter_(importerConstructor);
    if (foundIndex === undefined)
      throw new Error(typeName + ' not registered');
    Importer.importers_.splice(foundIndex, 1);
  };

  Importer.findImporterFor = function(eventData) {
    for (var i = 0; i < Importer.importers_.length; ++i)
      if (Importer.importers_[i].constructor.canImport(eventData))
        return Importer.importers_[i].constructor;
    return undefined;
  };

  return {
    Importer: Importer
  };
});
</script>
