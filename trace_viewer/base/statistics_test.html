<!DOCTYPE html>
<!--
Copyright (c) 2014 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->
<link rel="import" href="/base/statistics.html">
<script>
'use strict';

tv.b.unittest.testSuite(function() {
  var Statistics = tv.b.Statistics;

  test('sumBasic', function() {
    assert.equal(6, Statistics.sum([1, 2, 3]));
  });

  test('sumWithFunctor', function() {
    var ctx = {};
    var ary = [1, 2, 3];
    assert.equal(12, Statistics.sum(ary, function(x, i) {
      assert.equal(this, ctx);
      assert.equal(ary[i], x);
      return x * 2;
    }, ctx));
  });

  test('minMaxWithFunctor', function() {
    var ctx = {};
    var ary = [1, 2, 3];
    function func(x, i) {
      assert.equal(this, ctx);
      assert.equal(ary[i], x);
      return x;
    }
    assert.equal(3, Statistics.max(ary, func, ctx));
    assert.equal(1, Statistics.min(ary, func, ctx));

    var range = Statistics.range(ary, func, ctx);
    assertFalse(range.isEmpty);
    assert.equal(1, range.min);
    assert.equal(3, range.max);
  });

  test('maxExtrema', function() {
    assert.equal(-Infinity, Statistics.max([]));
    assert.equal(Infinity, Statistics.min([]));
  });

  test('meanBasic', function() {
    assert.equal(2, Statistics.mean([1, 2, 3]));
  });

  test('varianceBasic', function() {
    // In [2, 4, 4, 2], all items have a deviation of 1.0 from the mean so the
    // population variance is 4.0 / 4 = 1.0, but the sample variance is 4.0 / 3.
    assert.equal(4.0 / 3, Statistics.variance([2, 4, 4, 2]));

    // In [1, 2, 3], the squared deviations are 1.0, 0.0 and 1.0 respectively;
    // population variance 2.0 / 3 but sample variance is 2.0 / 2 = 1.0.
    assert.equal(1.0, Statistics.variance([1, 2, 3]));
  });

  test('varianceWithFunctor', function() {
    var ctx = {};
    var ary = [{x: 2},
               {x: 4},
               {x: 4},
               {x: 2}];
    assert.equal(4.0 / 3, Statistics.variance(ary, function(d) {
      assert.equal(ctx, this);
      return d.x;
    }, ctx));
  });

  test('stddevBasic', function() {
    assert.equal(Math.sqrt(4.0 / 3), Statistics.stddev([2, 4, 4, 2]));
  });

  test('stddevWithFunctor', function() {
    var ctx = {};
    var ary = [{x: 2},
               {x: 4},
               {x: 4},
               {x: 2}];
    assert.equal(Math.sqrt(4.0 / 3), Statistics.stddev(ary, function(d) {
      assert.equal(ctx, this);
      return d.x;
    }, ctx));
  });

  test('percentile', function() {
    var ctx = {};
    var ary = [{x: 0},
               {x: 1},
               {x: 2},
               {x: 3},
               {x: 4},
               {x: 5},
               {x: 6},
               {x: 7},
               {x: 8},
               {x: 9}];
    function func(d, i) {
      assert.equal(ctx, this);
      return d.x;
    }
    assert.equal(0, Statistics.percentile(ary, 0, func, ctx));
    assert.equal(4, Statistics.percentile(ary, .5, func, ctx));
    assert.equal(6, Statistics.percentile(ary, .75, func, ctx));
    assert.equal(9, Statistics.percentile(ary, 1, func, ctx));
  });

});
</script>
