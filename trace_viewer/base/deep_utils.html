<!DOCTYPE html>
<!--
Copyright (c) 2015 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->
<script>
'use strict';

tv.exportTo('tv.b', function() {
  function _iterateElementDeeplyImpl(element, cb, thisArg, includeElement) {
    if (includeElement) {
      if (cb.call(thisArg, element))
        return true;
    }

    if (element.shadowRoot) {
      if (_iterateElementDeeplyImpl(element.shadowRoot, cb, thisArg, false))
        return true;
    }
    for (var i = 0; i < element.children.length; i++) {
      if (_iterateElementDeeplyImpl(element.children[i], cb, thisArg, true))
        return true;
    }
  }
  function iterateElementDeeply(element, cb, thisArg) {
    _iterateElementDeeplyImpl(element, cb, thisArg, false);
  }

  function findDeepElementMatching(element, selector) {
    var foundElement = undefined;
    function matches(element) {
      var match = element.matches(selector);
      if (!match)
        return false;
      foundElement = element;
      return true;
    }
    iterateElementDeeply(element, matches);
    return foundElement;
  }
  return {
    iterateElementDeeply: iterateElementDeeply,
    findDeepElementMatching: findDeepElementMatching
  }
});
</script>