<!DOCTYPE HTML>
<!--
Copyright (c) 2015 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->
<link rel="import" href="/tracing/base/units/units.html">
<link rel="import" href="/tracing/base/units/histogram.html">
<link rel="import" href="/tracing/ui/base/dom_helpers.html">
<link rel="import" href="/tracing/ui/base/info_bar_group.html">
<link rel="import" href="/tracing/ui/base/overlay.html">
<link rel="import" href="/tracing/ui/units/generic_table_view.html">
<link rel="import" href="/tracing/ui/units/histogram_span.html">
<link rel="import" href="/perf_insights/results/results.html">
<link rel="import" href="/perf_insights/ui/reports/pi_report.html">
<link rel="import" href="/perf_insights/ui/grouping_table.html">
<link rel="import" href="/perf_insights/ui/generic_results_view.html">
<link rel="import" href="/perf_insights/mappers/slice_cost.html">

<polymer-element name="pi-ui-r-rail-score-report"
    extends="pi-ui-r-pi-report"
    map-function-href="/perf_insights/mappers/weather_report_map_function.html"
    map-function-name="weatherReportMapFunction">
  <template>
    <style>
      :host {
        display: flex;
        flex-direction: column;
      }
      #histogram {
        flex: 1 1 auto;
        max-width: 400px;
      }
    </style>
    <tr-ui-u-histogram-span id="histogram"></tr-ui-u-histogram-span>
  </template>
  <script>
  'use strict';

  Polymer({
    created: function() {
      this.mapResults_ = undefined;
    },

    ready: function() {
    },

    get mapResults() {
      return this.mapResults_;
    },

    set mapResults(mapResults) {
      this.mapResults_ = mapResults;
      this.updateContents_();
    },

    updateContents_: function() {
      var table = this.$.table;

      var results = this.mapResults_;
      if (!results)
        results = new tr.r.Results();

      var overallScoreHistogram = tr.b.u.Histogram.createLinear(
          tr.b.u.Units.normalizedPercentage,
          tr.b.Range.fromExplicitRange(0, 1),
          10);
      results.allValuesFromFailureFreeRuns.map(function(v) {
        if (!v.value.railScore)
          return;
        var railScore = v.value.railScore;
        overallScoreHistogram.add(railScore.overallScore,
                                  v.runInfo.url);
      });

      this.$.histogram.histogram = overallScoreHistogram;
    }
  });
  </script>
</polymer-element>
