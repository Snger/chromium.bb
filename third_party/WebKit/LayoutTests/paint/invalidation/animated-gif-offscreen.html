<!doctype HTML>
<body>
<div style="height: 2000px; width: 2000px;">
<img id="targetImage">
</div>
<script src="../../fast/repaint/resources/text-based-repaint.js"></script>
<script>
window.testIsAsync = true;

// The image should not show a repaint if offscreen if Slimming Paint is on.
// Otherwise it should, during this 200ms waiting period.

function targetImageOnload() {
  // After loading the image, force force a paint via displayAsyncThen.
  // This will then set off a timer for paint invalidation of 100ms
  // (100ms is the duration of the initial red frame of the GIF).
  // Then scroll the image offscreen before the first red frame ends.

  // After an interval safely larger than that, the timer should have fired and register a
  // *delayed* paint invalidation, since the image is offscreen. Since it never comes on screen
  // we should never see the actual paint invalidation in the output.
  testRunner.displayAsyncThen(function() {
    window.scrollTo(0, 1000);
    setTimeout(finishRepaintTest, 400); // The initial red frame of the GIF has a 100ms duration
  });
}

function repaintTest() {
  targetImage.onload = targetImageOnload;
  targetImage.src="../../fast/backgrounds/resources/red-green-animated.gif";
}

runRepaintTest();

</script>

</script>
