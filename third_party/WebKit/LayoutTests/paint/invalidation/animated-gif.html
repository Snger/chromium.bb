<!doctype HTML>
<body>
<div style="height: 2000px; width: 2000px;">
<img id="targetImage">
</div>
<script src="../../fast/repaint/resources/text-based-repaint.js"></script>
<script>
window.testIsAsync = true;

// Tests that a repaint of the image occurs during the 200ms waiting period.

function targetImageOnload() {
  // After loading the image, force a paint via displayAsyncThen. This will then set off a timer
  // for paint invalidation of 100ms (100ms is the duration of the initial red frame of the GIF).
  // After an interval safely larger than that, the timer should have fired and registered the
  // paint invalidation.
  testRunner.displayAsyncThen(function() {
    setTimeout(finishRepaintTest, 400);
  });
}

function repaintTest() {
  targetImage.onload = targetImageOnload;
  targetImage.src="../../fast/backgrounds/resources/red-green-animated.gif";
}

runRepaintTest();

</script>
