// Copyright (c) 2011 The Chromium OS Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

#ifndef GESTURES_ACTIVITY_REPLAY_H_
#define GESTURES_ACTIVITY_REPLAY_H_

#include <string>

#include <base/values.h>

#include "gestures/include/activity_log.h"
#include "gestures/include/gestures.h"
#include "gestures/include/interpreter.h"

// This class can parse a JSON log, as generated by ActivityLog and replay
// it on an interpreter.

namespace gestures {

class ActivityReplay {
 public:
  ActivityReplay();
  // Returns true on success.
  bool Parse(const std::string& data);
  void Replay(Interpreter* interpreter);

 private:
  // These return true on success
  bool ParseHardwareProperties(DictionaryValue* obj,
                               HardwareProperties* out_props);
  bool ParseEntry(DictionaryValue* entry);
  bool ParseHardwareState(DictionaryValue* entry);
  bool ParseFingerState(DictionaryValue* entry, FingerState* out_fs);
  bool ParseTimerCallback(DictionaryValue* entry);
  bool ParseCallbackRequest(DictionaryValue* entry);
  bool ParseGesture(DictionaryValue* entry);
  bool ParseGestureMove(DictionaryValue* entry, Gesture* out_gs);
  bool ParseGestureScroll(DictionaryValue* entry, Gesture* out_gs);
  bool ParseGestureButtonsChange(DictionaryValue* entry, Gesture* out_gs);

  ActivityLog log_;
  HardwareProperties hwprops_;
};

}  // namespace gestures

#endif  // GESTURES_ACTIVITY_REPLAY_H_
