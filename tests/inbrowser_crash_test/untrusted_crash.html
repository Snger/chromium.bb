<!--
  Copyright (c) 2011 The Native Client Authors. All rights reserved.
  Use of this source code is governed by a BSD-style license that can be
  found in the LICENSE file.
-->

<script type="text/javascript" src="nacltest.js"></script>

<div id="scratch_space"></div>

<script type="text/javascript">

var tester = new Tester();

tester.addAsyncTest('untrusted_crash', function(status) {
  var embed = document.createElement('embed');
  embed.width = 0;
  embed.height = 0;
  embed.src = 'inbrowser_crash_test.nmf';
  embed.type = 'application/x-nacl';
  embed.name = 'foo';

  var div = document.createElement('div');
  div.appendChild(embed);

  div.addEventListener('load', status.wrap(function(event) {
    status.fail('We expected this process to crash during startup');
  }), true);

  div.addEventListener('error', status.wrap(function(event) {
    status.log('Received error: ' + embed.lastError);
    status.assert(embed.lastError.indexOf('SRPC connection failure') != -1);
    status.pass();
  }), true);

  document.getElementById('scratch_space').appendChild(div);
});

tester.run();

</script>
