# -*- python -*-
# Copyright 2012 The Native Client Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

Import('env')

mmap_race_nexe = env.ComponentProgram('mmap_race', ['mmap_race.c'],
                                      EXTRA_LIBS=[
                                        'platform',
                                        'imc',
                                        'imc_syscalls',
                                        '${PTHREAD_LIBS}',
                                        '${NONIRT_LIBS}'])

if env.Bit('coverage_enabled'):
  expected_exit = 'naclabort_coverage'
else:
  expected_exit = 'sigabrt'

node = env.CommandSelLdrTestNacl('mmap_race_socketpair_test.out',
                                 mmap_race_nexe,
                                 ['-m', 'socketpair'],
                                 exit_status=expected_exit)

env.AddNodeToTestSuite(node, ['small_tests', 'mmap_race_tests'],
                       'run_mmap_race_socketpair_test')

node = env.CommandSelLdrTestNacl('mmap_race_connect_test.out',
                                 mmap_race_nexe,
                                 ['-m', 'imc_connect'],
                                 exit_status=expected_exit)

env.AddNodeToTestSuite(node, ['small_tests', 'mmap_race_tests'],
                       'run_mmap_race_connect_test')
