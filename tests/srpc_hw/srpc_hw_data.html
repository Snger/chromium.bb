<!DOCTYPE html>
<html>
  <head>
    <title>SRPC Simple Plug-in</title>
    <META HTTP-EQUIV="Pragma" CONTENT="no-cache" />
    <META HTTP-EQUIV="Expires" CONTENT="-1" />
    <script type="text/javascript" src="nacltest.js"></script>
    <script type="application/x-javascript">
      //<![CDATA[

function testMethods(tester, server) {
  tester.addTest('forty_two', function() {
    assertEqual(42, server.fortytwo());
  })
  tester.addTest('hello_world', function() {
    assertEqual('hello, world.', server.helloworld());
  })
}

// Data URIs need absolute URLs.
var base = document.location.href;
base = base.slice(0, base.lastIndexOf('/')+1)
var nmf_src = [
    '{',
    '  "program": {',
    '    "x86-32": {"url": "' + base + 'srpc_hw_x86-32.nexe"},',
    '    "x86-64": {"url": "' + base + 'srpc_hw_x86-64.nexe"},',
    '    "arm": {"url": "' + base + 'srpc_hw_arm.nexe"}',
    '  }',
    '}'].join('\n');

      //]]>
    </script>
  </head>
  <body>
    <h1>Native Client SRPC Simple Plug-in</h1>
    NOTE: Set NACL_ENABLE_EXPERIMENTAL_JAVASCRIPT_APIS=1 to run this test.

    <script type="text/javascript">
      //<![CDATA[

      // Create an embed with a data URI.
      var embed = document.createElement('embed');
      embed.type = 'application/x-nacl';
      embed.id = 'nacl_server';
      embed.name = 'nacl_module';
      embed.width = 0;
      embed.height = 0;
      embed.src = 'data:,' + escape(nmf_src);
      document.body.appendChild(embed);

      var tester = new Tester();
      tester.log(nmf_src);
      var server = $("nacl_server");
      testMethods(tester, server);
      tester.waitFor(server);
      tester.run();
      //]]>
    </script>
  </body>
</html>
