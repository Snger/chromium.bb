<!DOCTYPE html>
<html>
  <head>
    <title>SRPC Simple Plug-in</title>
    <META HTTP-EQUIV="Pragma" CONTENT="no-cache" />
    <META HTTP-EQUIV="Expires" CONTENT="-1" />
    <script type="text/javascript" src="nacltest.js"></script>
    <script type="application/x-javascript">
      //<![CDATA[

function loadAndTestMethods(tester, server) {
  tester.addTest('load_and_run_methods', function() {
    // Variables to hold the response.
    var responded = false;
    var nexe_file_descriptor_object = undefined;

    var Callback = function() {
      this.onload = function(fd) {
        nexe_file_descriptor_object = fd;
        responded = true;
      },
      this.onfail = function(message) {
      }
    };

    // Make the request.
    server.__urlAsNaClDesc('srpc_hw.nexe', new Callback());

    function wait() {
      if (!responded) {
        // Periodically poll until the results are ready.
        halt_and_callback(5, wait);
      } else {
        // Validate the results.
        tester.log(nexe_file_descriptor_object);
        server.__launchExecutableFromFd(nexe_file_descriptor_object);
        assertEqual(42, server.fortytwo());
        assertEqual('hello, world.', server.helloworld());
      }
    }
    wait();
  });
}

      //]]>
    </script>
  </head>
  <body>
    <h1>Native Client SRPC Plug-in from a File Descriptor</h1>
    NOTE: Set NACL_ENABLE_EXPERIMENTAL_JAVASCRIPT_APIS=1 to run this test.

    <embed type="application/x-nacl" id="nacl_server"
           name="nacl_module" width="0" height="0" src="srpc_hw.nmf" />

    <script type="text/javascript">
      //<![CDATA[
      var tester = new Tester();
      var server = $("nacl_server");
      loadAndTestMethods(tester, server);
      tester.waitFor(server);
      tester.run();
      //]]>
    </script>
  </body>
</html>
