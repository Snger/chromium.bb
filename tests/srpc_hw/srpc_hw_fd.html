<!DOCTYPE html>
<html>
  <head>
    <title>SRPC Simple Plug-in</title>
    <META HTTP-EQUIV="Pragma" CONTENT="no-cache" />
    <META HTTP-EQUIV="Expires" CONTENT="-1" />
  </head>
  <body>
<script type="text/javascript">
//<![CDATA[
function fortytwo() {
  var result = "";
  try {
    result = document.getElementById('pluginobj').fortytwo();
  } catch(e) {
    result = "ERROR: " + e;
  }
  alert("" + result);
}

function helloworld() {
  var result = "";
  try {
    result = document.getElementById('pluginobj').helloworld();
  } catch(e) {
    result = "ERROR: " + e;
  }
  alert("" + result);
}
//]]>
</script>

<h1>Native Client SRPC Plug-in from a File Descriptor</h1>
<p>
  <button onclick='loadNexe("srpc_hw.nexe")'>Load nexe</button>
</p>
<p>
  <button id='fortytwo' onclick='fortytwo()' disabled='disabled'>
    Call fortytwo()</button>
  <button id='helloworld' onclick='helloworld()' disabled='disabled'>
    Call helloworld()</button>

  <embed name="nacl_module"
         id="pluginobj"
         width=0 height=0
         type="application/x-nacl" />
</p>

<p>If the plug-in is working correctly, a click on the "Load nexe" button
  should change status to "SUCCESS", and allow clicking the other buttons. </p>

<p> Clicking on the "Call fortytwo" button
  should open a popup dialog containing <b>42</b> as value.</p>

<p> Clicking on the "Call helloworld" button
  should open a popup dialog containing <b>hello, world</b> as value.</p>

<h2>Status</h2>
<div id=status>NO-STATUS</div>

<script type="text/javascript">
//<![CDATA[
var nacl_embed = null;

var EnableButton = function(id) {
  var button = document.getElementById(id);
  button.disabled = null;
}

function Callback() {
  this.onload = function(nexe_fd) {
    nacl_embed.__launchExecutableFromFd(nexe_fd);
    EnableButton('fortytwo');
    EnableButton('helloworld');
    var status = document.getElementById('status');
    status.textContent = 'SUCCESS';
  },
  this.onfail = function(message) {
    var status = document.getElementById('status');
    status.textContent = 'LOAD FAILED';
  }
};

var loadNexe = function(url) {
  nacl_embed = document.getElementById('pluginobj');
  nacl_embed.__urlAsNaClDesc(url, new Callback());
}
//]]>
</script>

  </body>
</html>
