# -*- python -*-
# Copyright (c) 2011 The Native Client Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

Import('env')

stack_alignment_test_nexe = env.ComponentProgram('stack_alignment_test',
                                                 'stack_alignment_test.c',
                                                 EXTRA_LIBS=[
                                                     '${PTHREAD_LIBS}',
                                                     '${NONIRT_LIBS}'
                                                     ])
node = env.CommandSelLdrTestNacl('stack_alignment_test.out',
                                 stack_alignment_test_nexe)
env.AddNodeToTestSuite(node, ['small_tests'], 'run_stack_alignment_test')

if env.Bit('build_x86') and not env.Bit('bitcode'):
  # This tests use of x86-specific SSE operations.
  sse_alignment_test_nexe = env.ComponentProgram(
                                'sse_alignment_test',
                                'sse_alignment_test.c',
                                EXTRA_CFLAGS=['-msse2'],
                                EXTRA_LIBS=['${PTHREAD_LIBS}',
                                            '${NONIRT_LIBS}'])
  node = env.CommandSelLdrTestNacl('sse_alignment_test.out',
                                   sse_alignment_test_nexe)
  env.AddNodeToTestSuite(node, ['small_tests'], 'run_sse_alignment_test')
