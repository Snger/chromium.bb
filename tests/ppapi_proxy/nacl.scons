# -*- python -*-
# Copyright 2010 The Native Client Authors.  All rights reserved.  Use
# of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

Import('env')

env.Prepend(CPPDEFINES=['XP_UNIX'])

# TODO(robertm): those should not be necessary once we go -std=c99
env.FilterOut(CFLAGS=['-pedantic'])
env.FilterOut(CCFLAGS=['-pedantic'])

ppapi_basic_object_inputs = [
  'basic_object.cc',
]

# ARM gets error: undefined reference to 'NaClLog', so disable it for now.
# (NaClLog is pulled by nacl::assert_cast in src/shared/ppapi_proxy.)
if env['TARGET_ARCHITECTURE'] != 'arm':
  basic_object_nexe = env.ComponentProgram('ppapi_basic_object.nexe',
                                           ppapi_basic_object_inputs,
                                           EXTRA_LIBS=['google_nacl_imc',
                                                       'google_nacl_platform',
                                                       'ppruntime',
                                                       'pthread',
                                                       'srpc'])

  # Note that the html is required to run this program.
  env.Publish('ppapi_basic_object.nexe', 'run',
              [env.File('${SCONSTRUCT_DIR}/tests/nacl_js_lib.js'),
               'basic_object.html'])
