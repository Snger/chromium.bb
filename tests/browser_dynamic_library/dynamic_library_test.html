<!--
  Copyright 2011 The Native Client Authors. All rights reserved.
  Use of this source code is governed by a BSD-style license that can
  be found in the LICENSE file.
-->

<script type="text/javascript" src="nacltest.js"></script>
<script type="text/javascript" src="dynamic_library_helper.js"></script>

<embed id="plugin_element" type="application/x-nacl" width="0" height="0" />

<script type="text/javascript">

var rpc = new RPCWrapper();
rpc.startup();

var log = function(message) {
  rpc.log('test', message);
};

// This is based on the test in ppapi_core.html.
// Deliberately global - this what the nexe expects.
var CallOnMainThreadCallback_FromMainThread = function() {
  log('Received CallOnMainThread callback!');
  rpc.pass('test');
  rpc.shutdown();
};

var onPageLoad = function() {
  log('in onPageLoad()');
  var plugin = document.getElementById('plugin_element');

  var onPluginStart = function() {
    log('started OK');
    var value = plugin.testCallOnMainThread_FromMainThread();
    if (value !== true) {
      rpc.fail('test', 'Unexpected value: ' + value);
    }
  };

  startPluginInstance(plugin, log, ['./ppapi_core.nexe'], onPluginStart);
};

window.onload = onPageLoad;

</script>
