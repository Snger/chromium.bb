<!--
  Copyright (c) 2011 The Native Client Authors. All rights reserved.
  Use of this source code is governed by a BSD-style license that can be
  found in the LICENSE file.
-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <script type="text/javascript" src="nacltest.js"></script>
    <title>Native Client PPAPI Audio Test</title>
  </head>
  <h1>Native Client PPAPI Audio Test</h1>
  <body>

    <embed id="test_plugin"
      width=0 height=0
      src="ppapi_example_audio.nexe"
      type="application/x-nacl"
      amplitude_l="0"
      amplitude_r="0"
      duration_msec="1000" />

    <script type="text/javascript">
      //<![CDATA[
function setupTests(tester, plugin) {

  tester.addTest('TestPlayback', function() {
    var gotCallback = false;
    var gotValue;
    // Deliberately global - this what the nexe expects.
    window['StopPlaybackCompleted'] = function(value) {
      tester.log('Received callback: ' + value);
      if (!gotCallback) {
        gotCallback = true;
        gotValue = value;
      }
    }

    function wait() {
      if (!gotCallback) {
        halt_and_callback(1, wait);
      } else {
        assertEqual(gotValue, 'pass');
      }
    }

    wait();
  });

}

var tester = new Tester();
setupTests(tester, $('test_plugin'));
tester.waitFor($('test_plugin'));
tester.run();
      //]]>
    </script>

  </body>
</html>
