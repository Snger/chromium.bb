# -*- python -*-
# Copyright 2008 The Native Client Authors.  All rights reserved.
# Use of this source code is governed by a BSD-style license that can
# be found in the LICENSE file.


Import('env')

######################################################################
# Smoke Test
######################################################################
env.ComponentProgram('app_lib_test.nexe',
                     'app_lib_test.c',
                     EXTRA_LIBS=['pthread'],
                     )

# NOTE: we are using the same file as stdin and on the command line
#
# app_lib_test exercises stdio, in particular, it uses fopen on the
# command line argument, so it requires the -a flag to sel_ldr in
# order to access the filesystem.
node = env.CommandSelLdrTestNacl(
     'app_lib_test.out',
     command=[env.File('app_lib_test.nexe'), env.File('app_lib_test.stdin')],
     stdin=env.File('app_lib_test.stdin'),
     stdout_golden=env.File('app_lib_test.stdout'),
     sel_ldr_flags=['-a'],
     )

env.AddNodeToTestSuite(node, ['small_tests'], 'run_app_lib_test')
