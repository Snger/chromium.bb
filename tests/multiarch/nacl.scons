# -*- python -*-
# Copyright 2011 The Native Client Authors.  All rights reserved.
# Use of this source code is governed by a BSD-style license that can
# be found in the LICENSE file.

# Test of selection of the most appropriate nexe for a given CPU
# architecture.

Import('env')

# BUG(adonovan): test is breaking on ARM.  Disable in haste...
if env.Bit('target_arm'):
  Return()

# Use pre-built "Hello, World!" executables for several architectures.
node = env.PPAPIBrowserTester(
    'multiarch_test.out',
    url='multiarch.html',
    files=[env.File('multiarch.html'),
           env.File('multiarch.js'),
           env.File('multiarch.nmf'),
           env.File('${SCONSTRUCT_DIR}/tests/multiarch/srpc_hw_x86_32.nexe'),
           env.File('${SCONSTRUCT_DIR}/tests/multiarch/srpc_hw_x86_64.nexe'),
           env.File('${SCONSTRUCT_DIR}/tests/multiarch/srpc_hw_ARM.nexe'),
    ])

env.AddNodeToTestSuite(node,
                       ['chrome_browser_tests'],
                       'run_multiarch_test',
                       is_broken=env.PPAPIBrowserTesterIsBroken())
