<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <!-- Copyright 2009 Google Inc.  All rights reserved. -->
  <head>
    <title> SRPC Socket Address API Test </title>
    <META HTTP-EQUIV="Pragma" CONTENT="no-cache" />
    <META HTTP-EQUIV="Expires" CONTENT="-1" />
    <script type="text/javascript" src="nacltest.js"></script>
    <script type="application/x-javascript">
      //<![CDATA[
function defaultSocketAddressTests(tester, server) {
  tester.addTest('default_too_many', function() {
    assertRaises(function() { return server.__defaultSocketAddress('extra'); });
  });
  tester.addTest('default_conforming', function() {
    var sock_addr = server.__defaultSocketAddress();
    assertEqual(typeof(sock_addr), 'object');
  });
}

function connectTests(tester, server) {
  tester.addTest('connect_too_many', function() {
    assertRaises(function() {
        var default_addr = server.__defaultSocketAddress();
        assertEqual(typeof(default_addr), 'object');
        var connected_sock = default_addr.connect('extra'); });
  });
  tester.addTest('connect_default', function() {
    var default_addr = server.__defaultSocketAddress();
    assertEqual(typeof(default_addr), 'object');
    var connected_sock =  default_addr.connect();
    assertEqual(typeof(connected_sock), 'object');
  });
  tester.addTest('connect_nacl', function() {
    var sockaddr = server.start_server();
    assertEqual(typeof(sockaddr), 'object');
    var connected_sock = sockaddr.connect();
    assertEqual(typeof(connected_sock), 'object');
  });
}

function enqueueTests() {
  defaultSocketAddressTests(tester, server);
  connectTests(tester, server);
}
      //]]>
    </script>
  </head>
  <body>
    <h1> SRPC Socket Address API Test </h1>
    NOTE: Set NACL_ENABLE_EXPERIMENTAL_JAVASCRIPT_APIS=1 to run this test.
    <embed type="application/x-nacl" id="nacl_server" name="nacl_module"
            width="0" height="0" nacl="srpc_nrd_server.nmf" />

    <script type="text/javascript">
      //<![CDATA[
      var tester = new Tester();
      var server = $("nacl_server");
      enqueueTests(tester, server);
      tester.waitFor(server);
      tester.run();
      //]]>
    </script>
  </body>
</html>
