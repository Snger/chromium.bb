# Copyright (c) 2010 The Chromium Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

Import('env')

ppapi_tests_target = 'ppapi_tests_${TARGET_FULLARCH}'

ppapi_tests_sources = [
    # Common test files
    '${MAIN_DIR}/src/third_party/ppapi/tests/test_case.cc',
    '${MAIN_DIR}/src/third_party/ppapi/tests/test_utils.cc',
    '${MAIN_DIR}/src/third_party/ppapi/tests/testing_instance.cc',

    # Compile-time tests
    '${MAIN_DIR}/src/third_party/ppapi/tests/test_c_includes.c',
    '${MAIN_DIR}/src/third_party/ppapi/tests/test_cpp_includes.cc',
    '${MAIN_DIR}/src/third_party/ppapi/tests/test_struct_sizes.c',

    # Test cases (PLEASE KEEP THIS SECTION IN ALPHABETICAL ORDER)
    # Add/uncomment PPAPI interfaces below when they get proxied.
    #'${MAIN_DIR}/src/third_party/ppapi/tests/test_buffer.cc',
    #'${MAIN_DIR}/src/third_party/ppapi/tests/test_char_set.cc',
    #'${MAIN_DIR}/src/third_party/ppapi/tests/test_directory_reader.cc',
    #'${MAIN_DIR}/src/third_party/ppapi/tests/test_file_io.cc',
    #'${MAIN_DIR}/src/third_party/ppapi/tests/test_file_ref.cc',
    #'${MAIN_DIR}/src/third_party/ppapi/tests/test_file_system.cc',
    '${MAIN_DIR}/src/third_party/ppapi/tests/test_graphics_2d.cc',
    '${MAIN_DIR}/src/third_party/ppapi/tests/test_image_data.cc',
    '${MAIN_DIR}/src/third_party/ppapi/tests/test_paint_aggregator.cc',
    '${MAIN_DIR}/src/third_party/ppapi/tests/test_post_message.cc',
    '${MAIN_DIR}/src/third_party/ppapi/tests/test_scrollbar.cc',
    #'${MAIN_DIR}/src/third_party/ppapi/tests/test_transport.cc',
    #'${MAIN_DIR}/src/third_party/ppapi/tests/test_uma.cc',
    # Activating the URL loader test requires a test httpd that
    # understands HTTP POST, which our current httpd.py doesn't.
    # It also requires deactivating the tests that use FileIOTrusted
    # when running in NaCl.
    #'${MAIN_DIR}/src/third_party/ppapi/tests/test_url_loader.cc',
    #'${MAIN_DIR}/src/third_party/ppapi/tests/test_url_util.cc',
    #'${MAIN_DIR}/src/third_party/ppapi/tests/test_video_decoder.cc',

    # Deprecated test cases.
    '${MAIN_DIR}/src/third_party/ppapi/tests/test_instance_deprecated.cc',
    # Var_deprecated fails in TestPassReference, and we probably won't
    # fix it.
    #'${MAIN_DIR}/src/third_party/ppapi/tests/test_var_deprecated.cc'
    ]

ppapi_tests_nexe = env.ComponentProgram(ppapi_tests_target,
                                        ppapi_tests_sources,
                                        EXTRA_LIBS=['${PPAPI_LIBS}',
                                                    'ppapi_cpp'
                                                    ])

# Note that the html is required to run this program.
# To run, load page with mode=nacl search string:
# http://localhost:5103/scons-out/nacl-x86-32/staging/test_case.html?mode=nacl
# http://localhost:5103/scons-out/nacl-x86-64/staging/test_case.html?mode=nacl

env.Publish(ppapi_tests_target, 'run',
            ['${MAIN_DIR}/src/third_party/ppapi/tests/test_url_loader_data/*'],
            subdir='test_url_loader_data')

env.Publish(ppapi_tests_target, 'run',
            [ppapi_tests_nexe,
             '${MAIN_DIR}/src/third_party/ppapi/tests/test_case.html',
             'test_case.nmf',
             '${MAIN_DIR}/src/third_party/ppapi/tests/test_image_data',
             '${MAIN_DIR}/src/third_party/ppapi/tests/test_page.css'])
