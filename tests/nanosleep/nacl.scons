# -*- python -*-
# Copyright (c) 2011 The Native Client Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.


Import('env')

if 'TRUSTED_ENV' in env and (env['TRUSTED_ENV'].Bit('windows') or
                             env['TRUSTED_ENV'].Bit('mac')):
  env.Append(CPPDEFINES=[
      # Number of milliseconds by which a thread is allowed to wake up
      # early, after invoking nanosleep (on Windows, implemnted via
      # Sleep()).  On WinXP, Sleep sometimes return early.
      ['EARLY_WAKEUP_SLOP_MS', 10]
  ])

env.ComponentProgram('nanosleep_test.nexe',
                     'nanosleep_test.c',
                     EXTRA_LIBS=['pthread'])

node = env.CommandSelLdrTestNacl(
    'nanosleep_test.out',
    command=[env.File('nanosleep_test.nexe')])
env.AddNodeToTestSuite(node, ['small_tests'], 'run_nanosleep_test')
