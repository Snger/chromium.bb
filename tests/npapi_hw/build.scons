# -*- python -*-
# Copyright 2008 The Native Client Authors.  All rights reserved.
# Use of this source code is governed by a BSD-style license that can
# be found in the LICENSE file.


Import('env')


if env.Bit('linux'):
    env.Append(CPPDEFINES=['XP_UNIX'])


if env.Bit('mac'):
    env.Append(
        CPPDEFINES = [
            'XP_MACOSX',
            'XP_UNIX',
            ['TARGET_API_MAC_CARBON', '1'],
            'NO_X11',
            'USE_SYSTEM_CONSOLE',
        ],
    )


if env.Bit('windows'):
    env.Append(
        CCFLAGS = [
            '/EHsc',
        ],
        CPPDEFINES = [
            'XP_WIN', 'WIN32', '_WINDOWS'
        ],
    )


nacl_npapi_hw_test_inputs = [
  # TODO(robertm): make this into a library
  '$SOURCE_ROOT/googleclient/native_client/src/shared/imc/nacl_imc_c.cc',
  'npapi_hw.c',
  'npp_gate.c',
]
env.ComponentProgram('npapi_hw', nacl_npapi_hw_test_inputs,
                     EXTRA_LIBS=['google_nacl_npruntime', 'google_nacl_imc'])

# Note that the html is required to run this program.
env.Publish('npapi_hw', 'run', ['npapi_hw.html'])
