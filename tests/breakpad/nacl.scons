# -*- python -*-
# Copyright 2008 The Native Client Authors.  All rights reserved.
# Use of this source code is governed by a BSD-style license that can
# be found in the LICENSE file.

import os
Import('env')

nexe = env.ComponentProgram('breakpad.nexe',
                            'breakpad.c',
                            EXTRA_LIBS=['pthread'],
                            )

env.AppendENVPath('PATH',os.environ['PATH'])
print env['ENV']['PATH']

trusted_env = env.get('TRUSTED_ENV')
if trusted_env:
  # TODO(robertm): factor this hack
  sel_ldr = trusted_env.File('${STAGING_DIR}/${PROGPREFIX}sel_ldr${PROGSUFFIX}')

node = env.Command('breakpad.out',
                    ['test_breakpad.py', sel_ldr, nexe],
                    ("python $SOURCES > $TARGET"))

env.Alias(node, 'run_breakpad_test')

# TODO: re-enable when the win64 scons build is working
env.AddNodeToTestSuite(node, ['small_tests'], 'run_breakpad_test')
