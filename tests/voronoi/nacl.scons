# -*- python -*-
# Copyright 2010 The Native Client Authors.  All rights reserved.
# Use of this source code is governed by a BSD-style license that can
# be found in the LICENSE file.

Import('env')

######################################################################
# Smoke Test
######################################################################
nexe = env.ComponentProgram('voronoi.nexe',
                            ['voronoi.cc'],
                            EXTRA_LIBS=['av', 'srpc', 'm', 'pthread'])

# http://code.google.com/p/nativeclient/issues/detail?id=1300
is_broken = env.Bit('target_arm') and env.UsingEmulator()

node = env.CommandSelLdrTestNacl(
    'voronoi_test.out',
    loader='sel_universal',
    command=[env.File('voronoi.nexe'), '-t', '-d'],
    stdout_golden=env.File('voronoi.stdout'),
    stdin=env.File('voronoi.stdin'),
    )
env.AddNodeToTestSuite(node,
                       ['small_tests'],
                       'run_voronoi',
                       is_broken=is_broken)

env.Publish('voronoi.nexe', 'run', ['voronoi.html',])

# TODO(robertm): enable this ASAP
if env.Bit('target_arm'):
  Return()

node = env.DemoSelLdrNacl('demo_voronoi', nexe, args=['-m4', '-d'])
# Note: Make this available from top level
Alias('demo_voronoi', node)
