# -*- python -*-
# Copyright (c) 2012 The Native Client Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

Import('env')


test_libs = ['testrunner', 'imc_syscalls', 'platform', 'gio']
browser_test_libs = ['testrunner_browser', '${PPAPI_LIBS}', 'imc_syscalls']


objs = env.ComponentObject('imc_shm_mmap_test', 'imc_shm_mmap_test.c')

imc_shm_mmap_test_nexe_name = ('imc_shm_mmap_test_%s' %
                               env.get('TARGET_FULLARCH'))
imc_shm_mmap_test_nexe = env.ComponentProgram(imc_shm_mmap_test_nexe_name,
                                              objs,
                                              EXTRA_LIBS=browser_test_libs)

imc_shm_mmap_test_nonbrowser = env.ComponentProgram(
    'imc_shm_mmap_test_nonbrowser',
    objs,
    EXTRA_LIBS=test_libs + ['${PTHREAD_LIBS}', '${NONIRT_LIBS}'])

node = env.CommandSelLdrTestNacl('imc_shm_mmap_test.out',
                                 imc_shm_mmap_test_nonbrowser)
env.AddNodeToTestSuite(node, ['small_tests'], 'run_imc_shm_mmap_test')
